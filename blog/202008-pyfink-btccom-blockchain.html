<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">PyFlink 流批一体以及 BTC.com 在区块链领域的专业实践 | Dubuqingfeng</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://dubuqingfeng.xyz/blog/202008-pyfink-btccom-blockchain"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="PyFlink 流批一体以及 BTC.com 在区块链领域的专业实践 | Dubuqingfeng"><meta data-rh="true" name="description" content="概要： 大家好，我们是 BTC.com 团队。 2020 年，我们有幸接触到了 Flink 和 PyFlink 生态，从团队自身需求出发，完善了团队内实时计算的任务和需求，搭建了流批一体的计算环境。"><meta data-rh="true" property="og:description" content="概要： 大家好，我们是 BTC.com 团队。 2020 年，我们有幸接触到了 Flink 和 PyFlink 生态，从团队自身需求出发，完善了团队内实时计算的任务和需求，搭建了流批一体的计算环境。"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2020-09-08T11:42:00.000Z"><meta data-rh="true" property="article:tag" content="pyflink,btc.com,技术"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://dubuqingfeng.xyz/blog/202008-pyfink-btccom-blockchain"><link data-rh="true" rel="alternate" href="https://dubuqingfeng.xyz/blog/202008-pyfink-btccom-blockchain" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://dubuqingfeng.xyz/blog/202008-pyfink-btccom-blockchain" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://dubuqingfeng.xyz/blog/202008-pyfink-btccom-blockchain","mainEntityOfPage":"https://dubuqingfeng.xyz/blog/202008-pyfink-btccom-blockchain","url":"https://dubuqingfeng.xyz/blog/202008-pyfink-btccom-blockchain","headline":"PyFlink 流批一体以及 BTC.com 在区块链领域的专业实践","name":"PyFlink 流批一体以及 BTC.com 在区块链领域的专业实践","description":"概要： 大家好，我们是 BTC.com 团队。 2020 年，我们有幸接触到了 Flink 和 PyFlink 生态，从团队自身需求出发，完善了团队内实时计算的任务和需求，搭建了流批一体的计算环境。","datePublished":"2020-09-08T11:42:00.000Z","author":{"@type":"Person","name":"admin"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://dubuqingfeng.xyz/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Dubuqingfeng RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Dubuqingfeng Atom Feed"><link rel="stylesheet" href="/assets/css/styles.8d12b190.css">
<script src="/assets/js/runtime~main.50515d1a.js" defer="defer"></script>
<script src="/assets/js/main.e8e8cdbb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Dubuqingfeng</b></a><a class="navbar__item navbar__link" href="/docs">Intro</a><a class="navbar__item navbar__link" href="/docs/wiki">Wiki</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/sitenav">SiteNav</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Tools</a><ul class="dropdown__menu"><li><a href="https://json.cn" target="_blank" rel="noopener noreferrer" class="dropdown__link">JSON<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a class="dropdown__link" href="/tools/urlparam">URL Parameter Tool</a></li><li><a class="dropdown__link" href="/tools/compare/text">Compare Text</a></li><li><a class="dropdown__link" href="/tools/compare/code">Compare Code</a></li><li><a class="dropdown__link" href="/tools/compare/json">Compare JSON</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Blockchain</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tools/blockchain/decodetx">Decode Tx</a></li><li><a class="dropdown__link" href="/tools/blockchain/publishtx">Publish Tx</a></li><li><a class="dropdown__link" href="/tools/blockchain/runrpc?node=ethereum&amp;rpc=eth_blockNumber">Run RPC</a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/dubuqingfeng" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current,docs-openapi-classic-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">近期文章</div><div role="group"><h3 class="yearGroupHeading_rMGB">2026</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/202602-claude-codex-agent-skills-memory">Claude &amp; Codex 优化与配置</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/202506-yinanping-xinmao">意难平  |  心锚</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/202211-yinanping-donttrustverify">意难平  |  Don&#x27;t Trust, Verify！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/202202-bugufu-wulunduihecuo-ziwodeshenghuo">不辜负  |   勿论对与错，自我的生活</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/202202-bugufu-xuehuihezijihejie">不辜负  |   学会与自己和解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/202201-bugufu-rensheng">不辜负  |  人生</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/202201-bugufu-huakaiyoushimengxingyoushi">不辜负  |   花开有时，梦醒有时</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/202112-smartcontracts-riskanalysis-and-flashloan-exploits">智能合约安全分析与闪电贷利用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/202108-eth-scaling-and-eth2.0">eth 扩容及 eth 2.0，机遇</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/202105-bugufu-xunzhaonaxiemanxialaidejiaoluo">不辜负  |  寻找那些慢下来的角落</a></li></ul></div></nav></aside><main class="col col--7"><div class="sidebarToggleRow_RKTf"><button type="button" class="button button--sm button--secondary sidebarToggleButton_vr41">收起近期文章</button></div><article class="post_IeBf"><header><h1 class="title_xvU1 postTitle_nF1Z">PyFlink 流批一体以及 BTC.com 在区块链领域的专业实践</h1><div class="container_mt6G margin-vert--md"><time datetime="2020-09-08T11:42:00.000Z">2020年9月8日</time> · <!-- -->阅读需 16 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp" translate="no">admin</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="概要">概要：<a href="#概要" class="hash-link" aria-label="概要：的直接链接" title="概要：的直接链接" translate="no">​</a></h4>
<p>大家好，我们是 BTC.com 团队。 2020 年，我们有幸接触到了 Flink 和 PyFlink 生态，从团队自身需求出发，完善了团队内实时计算的任务和需求，搭建了流批一体的计算环境。</p>
<p>在实现实时计算的过程中，我们在实践中收获了一些经验，在此分享一些这方面的心路历程。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="0x01toc">0x01	TOC<a href="#0x01toc" class="hash-link" aria-label="0x01	TOC的直接链接" title="0x01	TOC的直接链接" translate="no">​</a></h2>
<ul>
<li class="">困惑 • 描述 • 思考 • 行动</li>
<li class="">流批一体的架构<!-- -->
<ul>
<li class="">架构</li>
<li class="">效果</li>
</ul>
</li>
<li class="">zeppelin，PyFlink on k8s 等实践<!-- -->
<ul>
<li class="">zeppelin</li>
<li class="">PyFlink on k8s</li>
</ul>
</li>
<li class="">区块链领域实践</li>
<li class="">展望 • 总结</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="0x02困惑--描述--思考--行动">0x02	困惑 • 描述 • 思考 • 行动<a href="#0x02困惑--描述--思考--行动" class="hash-link" aria-label="0x02	困惑 • 描述 • 思考 • 行动的直接链接" title="0x02	困惑 • 描述 • 思考 • 行动的直接链接" translate="no">​</a></h2>
<p>作为工程师，我们每天都在不断地了解需求，研发业务。</p>
<p>有一天，我们被拉到了一次团队总结会议上，收到了以下的需求：</p>
<p>销售总监 A：</p>
<p>我们想要知道销售的 历史和实时转化率、销售额，能不能统计一下实时的 TOP5 的商品，还有就是大促时候，用户实时访问、商品实时浏览量 TOP5 的情况呢，可以根据他历史访问的记录实时推荐相关的吗。</p>
<p>市场总监 B：</p>
<p>我们想要知道市场推广的效果，每次活动的实时数据，不然我们的市场投放无法准确评估效果，及时反馈啊。</p>
<p>研发总监 C：</p>
<p>有些用户的 bug 无法复现，日志可以再实时一点吗？传统日志分析，需要一定的梳理，可不可以直接清洗 / 处理相关的数据？</p>
<p>采购总监 D：</p>
<p>这些年是不是流行数字化，采购这边想预测采购需求，做一下实时分类和管理支出，预测未来供应来源，完善一下成本。这个有办法做吗？还有有些供应商不太稳定啊，能监控到他们的情况吗？</p>
<p>运维总监 E：</p>
<p>网站有时候访问比较慢，没有地方可以看到实时的机器情况，搞个什么监控大屏，这个有办法解决吗？</p>
<p>部门领导 F：</p>
<p>可以实现上面的人的需求吗。</p>
<p>做以上的了解之后，才发现，大家对于数据需求的渴望程度，使用方不仅需要历史的数据，而且还需要实时性的数据。</p>
<p>在电商、金融、制造等行业，数据有着迅猛的增长，诸多的企业面临着的新的挑战，数据分析的实时处理框架，比如说做一些实时数据分析报表、实时数据处理计算等。</p>
<p>和大多数企业类似，在此之前，我们是没有实时计算这方面的经验和积累的。这时，就开始困惑了，怎样可以更好地做上面的需求，在成本和效果之间取得平衡，如何设计相关的架构。</p>
<p><img decoding="async" loading="lazy" src="https://s1.ax1x.com/2020/09/16/w24yDA.jpg" alt="w24yDA.jpg" class="img_ev3q"></p>
<p>穷则思变，在有了困惑以后，我们就开始准备梳理已有的条件和我们到底需要什么。</p>
<p>首先我们的业务范围主要在区块链浏览器与数据服务、区块链矿池、多币种钱包等。在区块链浏览器的业务里，BTC.com 目前已是全球领先的区块链数据服务平台，矿池业务在业内排行第一，区块链浏览器也是全球前三大浏览器之一。</p>
<p>首先，我们通过 parser 解析区块链上的数据，得到各方面的数据信息，可以分析出每个币种的地址活跃度、地址交易情况、交易流向、参与程度等内容。目前，BTC.com 区块链浏览器与行业内各大矿池和交易所等公司都有相关合作，可以更好地实现一些数据的统计、整理、归纳、输出等。</p>
<p>面向的用户，不仅有专业的区块链开发人员，也有各样的 b 端和 c 端用户，c 端用户可以进行区块链地址的标注，智能合约的运行，查看智能合约相关内容等，以及链上数据的检索和查看。b 端用户则有更专业的支持和指导，提供 API、区块链节点等一些的定制以及交易加速、链上的业务合作、数据定制等。</p>
<p>从数据量级来讲，截至目前，比特币大概有 5 亿笔交易，3000 多万地址，22 亿输出（output：每笔交易的输出），并且还在不断增长中。以太坊的话，则更多。而 BTC.com 的矿池和区块链浏览器都支持多币种，各币种的总数据量级约为几十 T。</p>
<p>矿池是矿工购买矿机设备后连接到的服务平台，矿工可以通过连接矿池从而获取更稳定的收益。这是一个需要保证 7 * 24 小时稳定的服务，里面有矿机不断地提交其计算好的矿池下发的任务的解，矿池将达到网络难度的解进行广播。这个过程也可以认为是近乎是实时的，矿机通过提交到服务器，服务器内部再提交到 kafka 消息队列，同时有一些组件监听这些消息进行消费。而这些提交上来的解可以从中分析出矿机的工作状态、算力、连接情况等。</p>
<p>在业务上，我们需 要进行历史数据和实时数据的计算。</p>
<p>历史数据要关联一些币价，历史交易信息，而这些交易信息需要一直保存，是一种典型的批处理任务。</p>
<p>每当有新区块的确认，就有一些数据可以得到处理和分析，比如某个地址在这个区块里发生了一笔交易，那么可以从其交易流向去分析是什么样的交易，挖掘交易相关性。或者是在这个区块里有一些特殊的交易，比如 segwit 的交易、比如闪电网络的交易，就是有一些这个币种特有的东西可以进行解析分析和统计。并且在新区块确认时的难度预测也有所变化。</p>
<p>还有就是大额交易的监控，通过新区块的确认和未确认交易，锁定一些大额交易，结合地址的一些标注，锁定交易流向，更好地进行数据分析。</p>
<p>还有是一些区块链方面的 OLAP 方面的需求。</p>
<p><img decoding="async" loading="lazy" src="https://s1.ax1x.com/2020/09/16/w24sud.jpg" alt="w24sud.jpg" class="img_ev3q"></p>
<p>总结了在数据统计方面的需求和问题以后，我们就开始进行思考：什么是最合适的架构，如何让人员参与少，成本低。</p>
<p>解决问题，无非就是提出假设，通过度量，然后刷新认知。</p>
<p><img decoding="async" loading="lazy" src="https://s1.ax1x.com/2020/09/16/w245vQ.png" alt="w245vQ.png" class="img_ev3q"></p>
<p>在浏览了一些资料以后，我们认为，大部分的计算框架都是通过输入，进行处理，然后得到输出。首先，我们要获取到数据，这里数据可以从 MySQL 也可以从 Kafka，然后进行计算，这里计算可以是聚合，也可以是 TOP 5 类型的，在实时的话，可能还会有窗口类型的。在计算完之后，将结果做下发，下发到消息渠道和存储，发送到微信或者钉钉，落地到 MySQL 等。</p>
<p>团队一开始尝试了 spark，搭建了 yarn，使用了 airflow 作为调度框架，通过做 MySQL 的集成导 入，开发了一些批处理任务，有着离线任务的特点，数据固定，量大，计算周期长，需要做一些复杂操作。</p>
<p>在一些批处理任务上，这种架构是稳定的，但是随着业务的发展，有了越来越多的实时的需求，并且实时的数据并不能保证按顺序到达，按时间戳排序，消息的时间字段是允许前后有差距的。在数据模型上，需求驱动式的开发，成本相对来说，spark 的方式对于当时来说较高，对于状态的处理不是很好，导致影响一部分的效率。</p>
<p>其实在 2019 年的时候，就有在调研一些实时计算的事情，关注到了 Flink 框架，当时还是以 java 为主，整体框架概念上和 spark 不同，认为批处理是一种特殊的流，但是因为团队没有 java 方面的基因和沉淀，使用 Flink 作为实时计算的架构，在当时就暂告一个段落。在 2020 年初的时候，不管是<a href="https://mp.weixin.qq.com/s/kORFyI6Padhb551Gvpp9xQ" target="_blank" rel="noopener noreferrer" class="">阿里云</a>还是 infoq，还是 b 站，都有在推广 PyFlink，而且当时尤其是<a href="https://www.bilibili.com/video/BV1yt4y127sL" target="_blank" rel="noopener noreferrer" class="">程鹤群</a>和<a href="https://www.bilibili.com/video/BV1W7411o7Tj" target="_blank" rel="noopener noreferrer" class="">孙金城</a>的视频以及<a href="https://enjoyment.cool" target="_blank" rel="noopener noreferrer" class="">孙金城老师的博客</a>的印象深刻。于是就想尝试 PyFlink，其有着流批一体的优势，而且还支持 Python 的一些函数，支持 pandas，甚至以后还可以支持 tensorflow、keras，这对我们的吸引力是巨大的。在之后，就在构思我们的在 PyFlink 上的流批一体的架构。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="0x03流批一体的架构">0x03	流批一体的架构<a href="#0x03流批一体的架构" class="hash-link" aria-label="0x03	流批一体的架构的直 接链接" title="0x03	流批一体的架构的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="架构">架构<a href="#架构" class="hash-link" aria-label="架构的直接链接" title="架构的直接链接" translate="no">​</a></h3>
<p>首先我们要梳理数据，要清楚数据从哪里来。在以 spark 为主的时期，数据是定期从数据源加载（增量）数据，通过一定的转换逻辑，然后写入目的地，由于数据量和业务需要，延迟通常在小时级别，而实时的话，需要尽可能短的延迟，因此将数据源进行了分类，整体分成了几部分，一部分是传统的数据我们存放在 MySQL 持久化做保存，这部分之后可以直接作为批处理的计算，也可以导入 hive，做进一步的计算。实时的部分，实际上是有很多思路，一种方式是通过 MySQL 的 binlog 做解析，还有就是 MySQL 的 cdc 功能，在多方考量下，最后我们选择了 Kafka，不仅是因为其是优秀的分布式流式平台，而且团队也有对其的技术沉淀。</p>
<p>并且实际上在本地开发的时候，安装 Kafka 也比较方便，只需要<code> brew install kafka</code>，而且通过 conduktor 客户端，也可以方便的看到每个 Topic 的情况。于是就对现有的 Parser 进行改造，使其支持 Kafka，在当收到新的区块时，会立即向 Kafka 发送一个消息，然后进行处理。</p>
<p>大概是在 2018 年的时候，团队将整体的业务迁移到了 kubernetes 上，在业务不断发展的过程中，其对开发和运维上来说，减轻了很多负担，所以建议有一定规模的业务，最好是迁移到 kubernetes，其对成本的优化，DevOps，以及高可用的支持，都是其他平台和传统方式无法比拟的。</p>
<p>在开发作业的过程中，我们在尽可能的使用 Flink SQL，同时结合一些 Java 、Python 的 UDF，UDAF，UDTF。每个作业通过初始化类似于以下的语句，形成一定的模式：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">self.source_ddl = &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CREATE TABLE SourceTable (xxx int) WITH </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self.sink_ddl = &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CREATE TABLE SinkTable (xxx int) WITH </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">self.transform_ddl = &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INSERT INTO SinkTable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SELECT udf(xxx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FROM SourceTable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GROUP BY FROM_UNIXTIME(`timestamp`, &#x27;yyyyMMdd&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;&#x27;&#x27;</span><br></span></code></pre></div></div>
<p>在未来的话，会针对性地将数据进行分层，按照业界通用的 ODS、DWD、DWS、ADS，分出原始层，明细层和汇总层，进一步做好数据的治理。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="效果">效果<a href="#效果" class="hash-link" aria-label="效果的直接链接" title="效果的直接链接" translate="no">​</a></h3>
<p>最终我们团队基于 PyFlink 开发快速地完成了已有的任务，部分是批处理作业，处理过去几天的数据，部分是实时作业，根据 Kafka 的消息进行消费，目前还算比较稳定。</p>
<p>部署时选择了kubernetes，具体下面会进行分享。在 k8s 部署了 jobmanager 和 taskmanager，并且使用 kubernetes 的 job 功能作为批处理作业的部署，之后考虑接入一些监控平台，比如 Prometheus 之类的。</p>
<p>在成本方面，由于是使用的 kubernetes 集群，因此在机器上只有扩展主机的成本，在这种方式上，成本要比传统的 yarn 部署方式要低，并且之后 kuberntes 会支持原生部署，在扩展 jobmanager 和 taskmanager 上面会更加方便。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="0x04zeppelinpyflink-on-k8s-等实践">0x04	Zeppelin，PyFlink on k8s 等实践<a href="#0x04zeppelinpyflink-on-k8s-等实践" class="hash-link" aria-label="0x04	Zeppelin，PyFlink on k8s 等实践的直接链接" title="0x04	Zeppelin，PyFlink on k8s 等实践的直接链接" translate="no">​</a></h2>
<p>Zeppelin 是我们用来进行数据探索和逻辑验证，有些数据在本地不是真实数据，利用 Zeppelin 连接实际的链上数据，进行计算的逻辑验证，当验证完成后，便可转换成生产需要的代码进行部署。</p>
<p><img decoding="async" loading="lazy" src="https://s1.ax1x.com/2020/09/16/w2oAje.png" alt="w2oAje.png" class="img_ev3q"></p>
<p>一、kubernetes 上搭建 PyFlink 和 Zeppelin</p>
<ol>
<li class="">整理后的部署 Demo 在 github，可以参阅<a href="https://github.com/liuyangovo/Flink-Zeppelin-Demo" target="_blank" rel="noopener noreferrer" class="">这里</a></li>
<li class="">关于配置文件修改</li>
</ol>
<p>1). flink-conf.yaml</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">taskmanager.numberOfTaskSlots: 10</span><br></span></code></pre></div></div>
<p>这里可以调整 Taskmanager 可运行的的 job 的数量</p>
<p>2). zeppelin-site.xml</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cp conf/zeppelin-site.xml.template conf/zeppelin-site.xml; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &#x27;s#&lt;value&gt;127.0.0.1&lt;/value&gt;#&lt;value&gt;0.0.0.0&lt;/value&gt;#g&#x27; conf/zeppelin-site.xml; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &#x27;s#&lt;value&gt;auto&lt;/value&gt;#&lt;value&gt;local&lt;/value&gt;#g&#x27; conf/zeppelin-site.xml</span><br></span></code></pre></div></div>
<ul>
<li class="">修改请求来源为 0.0.0.0，如果是线上环境，建议开启白名单，加上 auth 认证。</li>
<li class="">修改 interpreter 的启动模式为 local，auto 会导致在集群启动时，以 k8s 的模式启动，目前 k8s 模式只支持 Spark, local 模式可以理解为，Zeppelin 将在本地启动一个连接 Flink 的 interpreter 进程。</li>
<li class="">Zeppelin 和在本地提交 Flink 作业类似，也需要 PyFlink 的基础环境，所以需要将 Flink 对应版本的 jar 包放入镜像内。</li>
</ul>
<ol start="3">
<li class="">Zeppelin 访问代理</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nginx.ingress.kubernetes.io/configuration-snippet: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header Upgrade &quot;websocket&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header Connection &quot;Upgrade&quot;;</span><br></span></code></pre></div></div>
<p>Zeppelin 在浏览器需要和 server 端建立 socket 连接，需要在 ingress 添加 websocket 配置。</p>
<ol start="4">
<li class="">Flink 和 Zeppelin 数据持久化</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- mountPath: /opt/flink/lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- mountPath: /zeppelin/notebook/</span><br></span></code></pre></div></div>
<ul>
<li class="">对 Flink 的 lib 做持久化的目的是需要 jar 包时可以直接进入 pod 下载，而无需更换镜像。</li>
<li class="">Zeppelin 的任务代码会存放在 notebook 目录下，保存编写好的代码。</li>
</ul>
<ol start="5">
<li class="">PyFlink 本地提交 job</li>
</ol>
<p>1). 本地安装 PyFlink</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ pip3 install apache-flink==1.11.1</span><br></span></code></pre></div></div>
<p>2). 测试 demo</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def word_count():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env = StreamExecutionEnvironment.get_execution_environment()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t_env = StreamTableEnvironment.create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        environment_settings=EnvironmentSettings.new_instance().use_blink_planner().build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sink_ddl = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        create table Results (word VARCHAR, `count` BIGINT) with ( &#x27;connector&#x27; = &#x27;print&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t_env.sql_update(sink_ddl)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elements = [(word, 1) for word in content.split(&quot; &quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 这里也可以通过 Flink SQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t_env.from_elements(elements, [&quot;word&quot;, &quot;count&quot;]) \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .group_by(&quot;word&quot;) \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .select(&quot;word, count(1) as count&quot;) \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .insert_into(&quot;Results&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t_env.execute(&quot;word_count&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging.basicConfig(stream=sys.stdout, level=logging.INFO, format=&quot;%(message)s&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    word_count()</span><br></span></code></pre></div></div>
<p>或者是实时处理的 Demo：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def handle_kafka_message():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s_env = StreamExecutionEnvironment.get_execution_environment()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # s_env.set_stream_time_characteristic(TimeCharacteristic.EventTime)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s_env.set_parallelism(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    st_env = StreamTableEnvironment \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .create(s_env, environment_settings=EnvironmentSettings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .new_instance()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .in_streaming_mode()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .use_blink_planner().build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_ddl = &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CREATE TABLE SourceTable (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      	word string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ) WITH (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;connector.type&#x27; = &#x27;kafka&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;connector.version&#x27; = &#x27;universal&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;connector.topic&#x27; = &#x27;Topic&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;connector.properties.bootstrap.servers&#x27; = &#x27;localhost:9092&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;connector.properties.zookeeper.connect&#x27; = &#x27;localhost:2121&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;format.type&#x27; = &#x27;json&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;format.derive-schema&#x27; = &#x27;true&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sink_ddl = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        create table Results (word VARCHAR) with (&#x27;connector&#x27; = &#x27;print&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    st_env.sql_update(sink_ddl)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    st_env.sql_update(source_ddl)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    st_env.from_path(&quot;source&quot;).insert_into(&quot;sink&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    st_env.execute(&quot;KafkaTest&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    handle_kafka_message()</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">本地测试 Flink 提交 job</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ flink run -m localhost:8081 -py word_count.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python/table/batch/word_count.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Job has been submitted with JobID 0a31b61c2f974bcc3f344f57829fc5d5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Program execution finished</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Job with JobID 0a31b61c2f974bcc3f344f57829fc5d5 has finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Job Runtime: 741 ms</span><br></span></code></pre></div></div>
<ol start="4">
<li class="">PyFlink 本地提交 Python Job，这里将相关代码进行了打包。</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ zip -r flinkdemo.zip ./*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ flink run -m localhost:8081 -pyfs flinkdemo.zip -pym main</span><br></span></code></pre></div></div>
<ol start="5">
<li class="">Kubernetes 通过集群本身的 Job 功能来提交 Job，之后会做自研一些 UI 后台界面做作业管理与监控。</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="0x05在区块链领域实践">0x05	在区块链领域实践<a href="#0x05在区块链领域实践" class="hash-link" aria-label="0x05	在区块链领域实践的直接链接" title="0x05	在区块链领域实践的直接链接" translate="no">​</a></h2>
<p>随着区块链技术的越来越成熟，应用越来越多，行业标准化、规范化的趋势也开始显现，也越来越依赖于云计算、大数据，毕竟是数字经济的产物。BTC.com 也在扎根于区块链技术基础设施，为各类公司各类应用提供数据和业务上的支持。</p>
<p>近些年，有个词火遍了 IT 业界，中台，不管是大公司还是创业公司，都喜欢扯上这个概念，号称自己业务中台，数据中台等。我们的理解中，中台是一种整合各方面资源的能力，从传统的单兵作战，到提升武器装备后勤保障，提升作战能力。在数据上打破数据孤岛，在需求快速变化的前台和日趋稳定的后台中取得平衡。而中台更重要的是服务，最终还是要回馈到客户，回馈到合作伙伴。</p>
<p>在区块链领域，BTC.com 有着深厚的行业技术积累，可以提供各方面数据化的能力。比如在利用机器学习进行链上数据的预估，预估 eth 的 gas price，还有最佳手续费等，利用 keras 深度学习的能力，进行一些回归计算，在之后也会将 Flink、机器学习和区块链结合起来，对外提供更多预测类和规范化分类的数据样本，之前是在用定时任务不断训练模型，与 Flink 结合之后，会更加实时。在这方面，以后也会提供更多的课题，比如币价与 Defi，舆情，市场等的关系，区块链地址与交易的标注和分类。甚至于将机器学习训练的模型，放于 IPFS 网络中，通过去中心化的代  币进行训练，提供方便调用样本和模型的能力。</p>
<p>在目前，BTC.com 推出了一些通过数据挖掘实现的能力，包括交易推送、OLAP 链上分析报表等，改善和提升相关行业和开发者实际的体验。我们在各种链上都有监控节点，监控各区块链网络的可用性、去中心化程度，监控智能合约。在接入一些联盟链、隐私加密货币，可以为联盟链、隐私加密货币提供这方面的数据能力。BTC.com 将为区块链产业生态发展做出更多努力，以科技公司的本质，以技术发展为第一驱动力，以市场和客户为导向，开发创新和融合应用，做好基础设施。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="0x06展望--总结">0x06	展望 / 总结<a href="#0x06展望--总结" class="hash-link" aria-label="0x06	展望 / 总结的直接链接" title="0x06	展望 / 总结的直接链接" translate="no">​</a></h2>
<p>从实时计算的趋势，到流批一体的架构，通过对 PyFlink 和 Flink 的学习，稳定在线上运行了多种作业任务，对接了实际业务需求。并且搭建了 Zeppelin 平台，使得业务开发上更加方便。在计算上尽可能地依赖 SQL，方便各方面的集成与调试。</p>
<p>在社区方面，PyFlink 也是没有令我们失望的，较快的响应能力，不断完善的文档。在 <a href="https://cwiki.apache.org/confluence/display/FLINK/Flink+Improvement+Proposals" target="_blank" rel="noopener noreferrer" class="">Confluence</a> 上也可以看到一些 Flink Improvement Proposals，其中也有一些是 PyFlink 相关的，在不远的将来，还会支持 Pandas UDAF，DataStream API，ML API，也期望在之后可以支持 Joblistener，总之，在这里也非常感谢相关团队。</p>
<p>未来的展望，总结起来就是，通过业务实现数据的价值化。而数据中台的终局，是将数据变现。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="参考资料">参考资料<a href="#参考资料" class="hash-link" aria-label="参考资料的直接链接" title="参考资料的直接链接" translate="no">​</a></h3>
<p><a href="https://www.infoq.cn/article/sKKHyb_jetRuDKXfqTwU" target="_blank" rel="noopener noreferrer" class="">唯品会实时计算平台的演进之路</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/87368233" target="_blank" rel="noopener noreferrer" class="">双11快到了，你的实时运营分析准备好了吗？</a></p>
<p><a href="https://www.donews.com/article/detail/4787/23860.html" target="_blank" rel="noopener noreferrer" class="">打造区块链王牌浏览器：欧科云链以 OKLink 打破多币种数据壁垒</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1483361" target="_blank" rel="noopener noreferrer" class="">你公司到底需不需要引入实时计算引擎？</a></p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/pyflink">pyflink</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/btc-com">btc.com</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/技术">技术</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/202012-flink-realtime-olap"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">实时 OLAP， 从 0 到 1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/201703-dishiyizhoufeiyuewutai"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">第十一周——飞跃舞台</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#0x01toc" class="table-of-contents__link toc-highlight">0x01	TOC</a></li><li><a href="#0x02困惑--描述--思考--行动" class="table-of-contents__link toc-highlight">0x02	困惑 • 描述 • 思考 • 行动</a></li><li><a href="#0x03流批一体的架构" class="table-of-contents__link toc-highlight">0x03	流批一体的架构</a><ul><li><a href="#架构" class="table-of-contents__link toc-highlight">架构</a></li><li><a href="#效果" class="table-of-contents__link toc-highlight">效果</a></li></ul></li><li><a href="#0x04zeppelinpyflink-on-k8s-等实践" class="table-of-contents__link toc-highlight">0x04	Zeppelin，PyFlink on k8s 等实践</a></li><li><a href="#0x05在区块链领域实践" class="table-of-contents__link toc-highlight">0x05	在区块链领域实践</a></li><li><a href="#0x06展望--总结" class="table-of-contents__link toc-highlight">0x06	展望 / 总结</a><ul><li><a href="#参考资料" class="table-of-contents__link toc-highlight">参考资料</a></li></ul></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Intro</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Internal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://crawlab.lab" target="_blank" rel="noopener noreferrer" class="footer__link-item">Crawlab<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="http://note.lab" target="_blank" rel="noopener noreferrer" class="footer__link-item">Note<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="http://nas.lab" target="_blank" rel="noopener noreferrer" class="footer__link-item">NAS<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="http://coder.lab" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coder<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/dubuqingfeng" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Dubuqingfeng, Inc.</div></div></div></footer></div>
</body>
</html>
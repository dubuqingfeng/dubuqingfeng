### 分区与分片

单库分区与多库分片策略，对查询/写入/事务的一致性影响。

#### 要点
- 分区：范围/列表/哈希/复合；分区裁剪与全分区扫描；
- 分片：水平拆分的路由与热点问题；
- 跨分区/分片查询与聚合、二次过滤；
- 全局唯一与跨分片事务的补偿。

#### 分区键/主键选择

- 分区键尽量与查询过滤条件一致（如时间范围）；
- 主键与分区键关系：避免热点（自增可能集中写入），必要时引入雪花/时间混合键。

#### 分片后的查询策略

- 路由：应用侧根据分片键路由到目标库；
- 聚合：并行查询各分片再汇总；
- 维度查询：冗余维度或全局二级索引服务化。

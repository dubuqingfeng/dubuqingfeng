"use strict";(globalThis.webpackChunkdubuqingfeng=globalThis.webpackChunkdubuqingfeng||[]).push([[7139],{28453:(i,n,e)=>{e.d(n,{R:()=>r,x:()=>l});var c=e(96540);const s={},t=c.createContext(s);function r(i){const n=c.useContext(t);return c.useMemo(function(){return"function"==typeof i?i(n):{...n,...i}},[n,i])}function l(i){let n;return n=i.disableParentContext?"function"==typeof i.components?i.components(s):i.components||s:r(i.components),c.createElement(t.Provider,{value:n},i.children)}},52765:(i,n,e)=>{e.r(n),e.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>d});const c=JSON.parse('{"id":"Wiki/blockchain/bitcoin/script/tapscript","title":"tapscript","description":"Tapscript\uff08BIP342\uff09","source":"@site/docs/Wiki/blockchain/bitcoin/script/tapscript.md","sourceDirName":"Wiki/blockchain/bitcoin/script","slug":"/Wiki/blockchain/bitcoin/script/tapscript","permalink":"/docs/Wiki/blockchain/bitcoin/script/tapscript","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"standardness","permalink":"/docs/Wiki/blockchain/bitcoin/script/standardness"},"next":{"title":"\u8ba1\u7b97\u4ea4\u6613\u624b\u7eed\u8d39\u811a\u672c","permalink":"/docs/Wiki/blockchain/bitcoin/transaction/fee"}}');var s=e(74848),t=e(28453);const r={},l=void 0,o={},d=[{value:"Tapscript\uff08BIP342\uff09",id:"tapscriptbip342",level:2},{value:"\u5173\u952e\u53d8\u5316",id:"\u5173\u952e\u53d8\u5316",level:3},{value:"\u811a\u672c\u8def\u5f84\u4e0e\u63a7\u5236\u5757",id:"\u811a\u672c\u8def\u5f84\u4e0e\u63a7\u5236\u5757",level:3},{value:"\u591a\u7b7e\u793a\u4f8b\uff08M-of-N \u601d\u8def\uff09",id:"\u591a\u7b7e\u793a\u4f8bm-of-n-\u601d\u8def",level:3},{value:"SIGHASH \u4e0e\u9ed8\u8ba4\u884c\u4e3a",id:"sighash-\u4e0e\u9ed8\u8ba4\u884c\u4e3a",level:3},{value:"\u5b9e\u8df5\u8981\u70b9",id:"\u5b9e\u8df5\u8981\u70b9",level:3}];function a(i){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...i.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"tapscriptbip342",children:"Tapscript\uff08BIP342\uff09"}),"\n",(0,s.jsx)(n.p,{children:"Tapscript \u662f Taproot \u7684\u811a\u672c\u8bed\u4e49\u66f4\u65b0\uff0c\u914d\u5408 Schnorr\uff08BIP340\uff09\u4e0e Taproot\uff08BIP341\uff09\u5f15\u5165\u66f4\u7b80\u6d01\u3001\u53ef\u7ec4\u5408\u7684\u811a\u672c\u8868\u8fbe\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"\u5173\u952e\u53d8\u5316",children:"\u5173\u952e\u53d8\u5316"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"OP_CHECKSIGADD"}),"\uff1a\u6bcf\u6b21\u6821\u9a8c\u7d2f\u52a0 0/1 \u5230\u8ba1\u6570\u5668\uff0c\u4fbf\u4e8e\u7075\u6d3b\u8868\u8fbe M-of-N \u591a\u7b7e"]}),"\n",(0,s.jsxs)(n.li,{children:["\u53bb\u9664\u4e86 ",(0,s.jsx)(n.code,{children:"CHECKMULTISIG"})," \u7684\u5386\u53f2\u201c+1 bug\u201d\u4e0e\u989d\u5916\u5f00\u9500"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5f15\u5165 ",(0,s.jsx)(n.code,{children:"OP_SUCCESSx"})," \u4f5c\u4e3a\u8f6f\u5206\u53c9\u6269\u5c55\u4fdd\u7559\u7801"]}),"\n",(0,s.jsx)(n.li,{children:"\u66f4\u65b0\u8d44\u6e90\u8ba1\u8d39\u4e0e\u9650\u5236\uff1a\u76f8\u8f83 v0 witness \u66f4\u5408\u7406"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u811a\u672c\u8def\u5f84\u4e0e\u63a7\u5236\u5757",children:"\u811a\u672c\u8def\u5f84\u4e0e\u63a7\u5236\u5757"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u82b1\u8d39\u811a\u672c\u53f6\u5b50\u65f6\uff0cwitness \u9700\u63d0\u4f9b\uff1a","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"\u2026 <script> <control block>"})}),"\n",(0,s.jsxs)(n.li,{children:["control block \u5305\u542b\uff1a\u5947\u5076\u4f4d + \u5185\u90e8\u516c\u94a5 ",(0,s.jsx)(n.code,{children:"P"})," + Merkle \u8def\u5f84\uff08\u7528\u4e8e\u91cd\u6784 Q \u5e76\u9a8c\u8bc1 tweak\uff09"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"TapLeaf"})," \u54c8\u5e0c\uff1a",(0,s.jsx)(n.code,{children:'tagged_hash("TapLeaf", ver || compact_size(len(script)) || script)'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u591a\u7b7e\u793a\u4f8bm-of-n-\u601d\u8def",children:"\u591a\u7b7e\u793a\u4f8b\uff08M-of-N \u601d\u8def\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"<pk1> CHECKSIGADD <pk2> CHECKSIGADD ... <pkN> CHECKSIGADD <M> NUMEQUAL\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6bcf\u4e2a\u7b7e\u540d\u6210\u529f\u540e\u7d2f\u52a0 1\uff0c\u6700\u7ec8\u4e0e\u5e38\u91cf M \u6bd4\u8f83\u76f8\u7b49\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"sighash-\u4e0e\u9ed8\u8ba4\u884c\u4e3a",children:"SIGHASH \u4e0e\u9ed8\u8ba4\u884c\u4e3a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528 BIP340 \u7b7e\u540d\u4e0e\u54c8\u5e0c\u57df\uff1b\u9ed8\u8ba4\u8986\u76d6\u5168\u90e8\u8f93\u5165/\u8f93\u51fa"}),"\n",(0,s.jsx)(n.li,{children:"annex\u3001tapleaf/path\u3001script version \u7b49\u53ef\u9009\u57df\u5728 script-path \u4e0b\u53c2\u4e0e\u6458\u8981"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5b9e\u8df5\u8981\u70b9",children:"\u5b9e\u8df5\u8981\u70b9"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5730\u5740\u5c42\u9762\u4ecd\u662f P2TR\uff08Bech32m\uff0cx-only ",(0,s.jsx)(n.code,{children:"Qx"}),"\uff09"]}),"\n",(0,s.jsx)(n.li,{children:"Tapscript \u4e3b\u8981\u5f71\u54cd script-path \u7684\u8868\u8fbe\u80fd\u529b\u4e0e\u9a8c\u8bc1\u8bed\u4e49"}),"\n",(0,s.jsx)(n.li,{children:"\u914d\u5408 Descriptors/Miniscript \u53ef\u5b9e\u73b0\u53ef\u5ba1\u6838\u3001\u53ef\u7ec4\u5408\u7684\u94b1\u5305\u7b56\u7565"}),"\n"]})]})}function p(i={}){const{wrapper:n}={...(0,t.R)(),...i.components};return n?(0,s.jsx)(n,{...i,children:(0,s.jsx)(a,{...i})}):a(i)}}}]);
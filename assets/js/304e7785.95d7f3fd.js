"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[8360],{12378:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"Wiki/blockchain/bitcoin/transaction/sighash","title":"sighash","description":"\u7b7e\u540d\u54c8\u5e0c\u4e0e SIGHASH","source":"@site/docs/Wiki/blockchain/bitcoin/transaction/sighash.md","sourceDirName":"Wiki/blockchain/bitcoin/transaction","slug":"/Wiki/blockchain/bitcoin/transaction/sighash","permalink":"/docs/Wiki/blockchain/bitcoin/transaction/sighash","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"locktime","permalink":"/docs/Wiki/blockchain/bitcoin/transaction/locktime"},"next":{"title":"structure","permalink":"/docs/Wiki/blockchain/bitcoin/transaction/structure"}}');var t=n(74848),c=n(28453);const r={},l=void 0,o={},a=[{value:"\u7b7e\u540d\u54c8\u5e0c\u4e0e SIGHASH",id:"\u7b7e\u540d\u54c8\u5e0c\u4e0e-sighash",level:2},{value:"\u4f20\u7edf\uff08pre-SegWit\uff09",id:"\u4f20\u7edfpre-segwit",level:3},{value:"SegWit v0\uff08BIP143\uff09",id:"segwit-v0bip143",level:3},{value:"Taproot / Tapscript\uff08BIP341/342\uff09",id:"taproot--tapscriptbip341342",level:3},{value:"SIGHASH \u9009\u62e9\u5efa\u8bae",id:"sighash-\u9009\u62e9\u5efa\u8bae",level:3}];function h(e){const i={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h2,{id:"\u7b7e\u540d\u54c8\u5e0c\u4e0e-sighash",children:"\u7b7e\u540d\u54c8\u5e0c\u4e0e SIGHASH"}),"\n",(0,t.jsxs)(i.p,{children:["\u7b7e\u540d\u54c8\u5e0c\u51b3\u5b9a\u201c\u7b7e\u540d\u8986\u76d6\u7684\u8303\u56f4\u201d\u3002\u5e38\u89c1\u7c7b\u578b\uff1a",(0,t.jsx)(i.code,{children:"SIGHASH_ALL/NONE/SINGLE"})," \u4e0e ",(0,t.jsx)(i.code,{children:"ANYONECANPAY"})," \u53ef\u7ec4\u5408\u3002"]}),"\n",(0,t.jsx)(i.h3,{id:"\u4f20\u7edfpre-segwit",children:"\u4f20\u7edf\uff08pre-SegWit\uff09"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"\u6458\u8981\u53d6\u51b3\u4e8e\u811a\u672c\u66ff\u6362\u3001\u8f93\u51fa\u5b50\u96c6\u3001\u5e8f\u5217\u7b49\u7ec6\u8282\uff0c\u5bb9\u6613\u51fa\u9519\u5e76\u5f15\u5165 malleability"}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"scriptCode"})," \u9700\u79fb\u9664 ",(0,t.jsx)(i.code,{children:"OP_CODESEPARATOR"})," \u4e4b\u540e\u7684\u5b57\u8282\uff1b\u7b7e\u540d\u8986\u76d6\u89c4\u5219\u590d\u6742"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"segwit-v0bip143",children:"SegWit v0\uff08BIP143\uff09"}),"\n",(0,t.jsx)(i.p,{children:"\u4e3a\u4fee\u590d\u8986\u76d6\u4e0d\u8db3\u4e0e\u53ef\u5851\u6027\u95ee\u9898\uff0c\u5f15\u5165\u4e09\u4e2a\u9884\u54c8\u5e0c\u57df\u5e76\u52a0\u5165\u91d1\u989d\uff1a"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-text",children:"hashPrevouts  = Hash256( concat(all inputs' outpoints) )\nhashSequence  = Hash256( concat(all inputs' sequences) )\nhashOutputs   = Hash256( concat(all outputs) )\n\ndigest = Hash256(\n  ser(version)||hashPrevouts||hashSequence||outpoint_i||\n  scriptCode_i||value_i||sequence_i||hashOutputs||locktime||sighashType\n)\n"})}),"\n",(0,t.jsxs)(i.p,{children:["\u6ce8\u610f\uff1a",(0,t.jsx)(i.code,{children:"scriptCode_i"})," \u5bf9 WPKH \u4e0d\u662f\u539f\u59cb ",(0,t.jsx)(i.code,{children:"scriptPubKey"}),"\uff0c\u800c\u662f\u7279\u5b9a\u6a21\u677f\uff08DUP HASH160 \u2026 CHECKSIG\uff09\u3002"]}),"\n",(0,t.jsx)(i.h3,{id:"taproot--tapscriptbip341342",children:"Taproot / Tapscript\uff08BIP341/342\uff09"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"\u4f7f\u7528 BIP340 Schnorr \u7b7e\u540d\uff0cx-only \u516c\u94a5\u4e0e 64B \u7b7e\u540d"}),"\n",(0,t.jsx)(i.li,{children:"\u66f4\u7075\u6d3b\u7684\u7b7e\u540d\u54c8\u5e0c\u57df\uff0c\u652f\u6301 key-path \u4e0e script-path\uff0c\u4e0d\u518d\u4f7f\u7528 DER \u7f16\u7801"}),"\n",(0,t.jsxs)(i.li,{children:["\u5f15\u5165 ",(0,t.jsx)(i.code,{children:"OP_CHECKSIGADD"})," \u7b80\u5316\u805a\u5408\u4e0e\u591a\u7b7e\u8868\u8fbe"]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"\u5173\u952e\u8981\u70b9\uff1a"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"key-path \u9ed8\u8ba4\u8986\u76d6\u5168\u90e8\u8f93\u5165/\u8f93\u51fa\uff1b\u652f\u6301 annex\u3001tapleaf/path\u3001\u811a\u672c\u7248\u672c\u7b49\u53ef\u9009\u57df"}),"\n",(0,t.jsx)(i.li,{children:"script-path \u9700\u643a\u5e26 control block \u4e0e leaf \u4fe1\u606f\u53c2\u4e0e\u6458\u8981"}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"sighash-\u9009\u62e9\u5efa\u8bae",children:"SIGHASH \u9009\u62e9\u5efa\u8bae"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\u4e00\u822c\u8f6c\u8d26\uff1a",(0,t.jsx)(i.code,{children:"SIGHASH_ALL"}),"\uff08\u9ed8\u8ba4\uff09"]}),"\n",(0,t.jsxs)(i.li,{children:["\u591a\u65b9\u534f\u4f5c/\u66ff\u6362\uff1a\u53ef\u8003\u8651 ",(0,t.jsx)(i.code,{children:"ANYONECANPAY|SINGLE"})," \u7b49\u9ad8\u7ea7\u7ec4\u5408\uff0c\u4f46\u9700\u8c28\u614e\u9a8c\u8bc1\u8986\u76d6\u8303\u56f4"]}),"\n"]})]})}function d(e={}){const{wrapper:i}={...(0,c.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>r,x:()=>l});var s=n(96540);const t={},c=s.createContext(t);function r(e){const i=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(c.Provider,{value:i},e.children)}}}]);
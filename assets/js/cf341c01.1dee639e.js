"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[7492],{65255:(n,i,e)=>{e.r(i),e.d(i,{assets:()=>d,contentTitle:()=>l,default:()=>x,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"Wiki/blockchain/bitcoin/transaction/structure","title":"structure","description":"\u4ea4\u6613\u7ed3\u6784\u4e0e\u5e8f\u5217\u5316","source":"@site/docs/Wiki/blockchain/bitcoin/transaction/structure.md","sourceDirName":"Wiki/blockchain/bitcoin/transaction","slug":"/Wiki/blockchain/bitcoin/transaction/structure","permalink":"/docs/Wiki/blockchain/bitcoin/transaction/structure","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"sighash","permalink":"/docs/Wiki/blockchain/bitcoin/transaction/sighash"},"next":{"title":"descriptor","permalink":"/docs/Wiki/blockchain/bitcoin/wallet/descriptor"}}');var r=e(74848),s=e(28453);const c={},l=void 0,d={},a=[{value:"\u4ea4\u6613\u7ed3\u6784\u4e0e\u5e8f\u5217\u5316",id:"\u4ea4\u6613\u7ed3\u6784\u4e0e\u5e8f\u5217\u5316",level:2},{value:"\u8f93\u5165\u4e0e\u8f93\u51fa",id:"\u8f93\u5165\u4e0e\u8f93\u51fa",level:3},{value:"txid \u4e0e wtxid",id:"txid-\u4e0e-wtxid",level:3},{value:"VarInt \u4e0e\u7aef\u5e8f",id:"varint-\u4e0e\u7aef\u5e8f",level:3},{value:"SegWit \u5e8f\u5217\u5316\uff08v0\uff09",id:"segwit-\u5e8f\u5217\u5316v0",level:3},{value:"Go \u4f2a\u4ee3\u7801\uff1aHash256 \u4e0e VarInt",id:"go-\u4f2a\u4ee3\u7801hash256-\u4e0e-varint",level:3},{value:"\u5e38\u89c1\u9677\u9631",id:"\u5e38\u89c1\u9677\u9631",level:3}];function o(n){const i={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.h2,{id:"\u4ea4\u6613\u7ed3\u6784\u4e0e\u5e8f\u5217\u5316",children:"\u4ea4\u6613\u7ed3\u6784\u4e0e\u5e8f\u5217\u5316"}),"\n",(0,r.jsx)(i.p,{children:"\u5178\u578b\u4ea4\u6613\uff08\u975e SegWit\uff09\uff1a"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-text",children:"version | tx_in_count | [txin...] | tx_out_count | [txout...] | locktime\n"})}),"\n",(0,r.jsxs)(i.p,{children:["SegWit \u4ea4\u6613\u591a\u51fa\u4e24\u5b57\u8282\uff1a",(0,r.jsx)(i.code,{children:"marker=0x00, flag=0x01"}),"\uff0c\u5e76\u5728\u5c3e\u90e8\u9644\u5e26 ",(0,r.jsx)(i.code,{children:"witness"}),"\u3002"]}),"\n",(0,r.jsx)(i.h3,{id:"\u8f93\u5165\u4e0e\u8f93\u51fa",children:"\u8f93\u5165\u4e0e\u8f93\u51fa"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\u8f93\u5165\uff08TxIn\uff09\uff1a",(0,r.jsx)(i.code,{children:"outpoint(txid,vout) | scriptSig | sequence"})]}),"\n",(0,r.jsxs)(i.li,{children:["\u8f93\u51fa\uff08TxOut\uff09\uff1a",(0,r.jsx)(i.code,{children:"value(int64) | scriptPubKey"})]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["UTXO \u6a21\u578b\uff1a\u8f93\u51fa\u4e0d\u53ef\u53d8\uff0c\u901a\u8fc7\u8f93\u5165\u7cbe\u786e\u5f15\u7528 ",(0,r.jsx)(i.code,{children:"outpoint=(txid,vout)"})," \u6765\u201c\u82b1\u8d39\u201d\u6307\u5b9a\u8f93\u51fa\u3002"]}),"\n",(0,r.jsx)(i.h3,{id:"txid-\u4e0e-wtxid",children:"txid \u4e0e wtxid"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"txid\uff1a\u5bf9\u201c\u57fa\u7840\u5e8f\u5217\u5316\uff08\u4e0d\u542b witness\uff09\u201d\u7684\u53cc SHA256"}),"\n",(0,r.jsx)(i.li,{children:"wtxid\uff1a\u5bf9\u201c\u5b8c\u6574\u5e8f\u5217\u5316\uff08\u542b witness\uff09\u201d\u7684\u53cc SHA256"}),"\n",(0,r.jsx)(i.li,{children:"\u9694\u79bb\u89c1\u8bc1\u540e\uff0c\u7b2c\u4e09\u65b9\u66f4\u6539 scriptSig \u4e0d\u4f1a\u6539\u53d8 txid\uff08\u6d88\u9664 malleability\uff09"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"varint-\u4e0e\u7aef\u5e8f",children:"VarInt \u4e0e\u7aef\u5e8f"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\u53d8\u957f\u6574\u6570\uff08VarInt\uff09\uff1a","\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"< 0xFD"}),"\uff1a\u5355\u5b57\u8282"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"0xFD"})," \u540e\u8ddf ",(0,r.jsx)(i.code,{children:"uint16 (LE)"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"0xFE"})," \u540e\u8ddf ",(0,r.jsx)(i.code,{children:"uint32 (LE)"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"0xFF"})," \u540e\u8ddf ",(0,r.jsx)(i.code,{children:"uint64 (LE)"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.li,{children:"\u6ce8\u610f\u6df7\u5408\u7aef\u5e8f\uff1a\u5b57\u6bb5\u591a\u4e3a\u5c0f\u7aef\u5e8f\u5217\u5316\uff0c\u4f46\u54c8\u5e0c\u663e\u793a\u5e38\u4ee5\u201c\u53cd\u8f6c\u5b57\u8282\u5e8f\u201d\u7684\u5f62\u5f0f\u5c55\u793a"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"segwit-\u5e8f\u5217\u5316v0",children:"SegWit \u5e8f\u5217\u5316\uff08v0\uff09"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-text",children:"version | 0x00 | 0x01 | tx_in_count | [txin...] | tx_out_count | [txout...] | witness | locktime\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u6bcf\u4e2a\u8f93\u5165\u5bf9\u5e94\u4e00\u4e2a witness \u6808\uff08stack items\uff09\uff0c\u7528\u4e8e\u643a\u5e26\u7b7e\u540d\u3001\u516c\u94a5\u6216\u811a\u672c\u7b49\u89c1\u8bc1\u6570\u636e\u3002"}),"\n",(0,r.jsx)(i.h3,{id:"go-\u4f2a\u4ee3\u7801hash256-\u4e0e-varint",children:"Go \u4f2a\u4ee3\u7801\uff1aHash256 \u4e0e VarInt"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-go",children:"func Hash256(b []byte) [32]byte {\n    h1 := sha256.Sum256(b)\n    h2 := sha256.Sum256(h1[:])\n    return h2\n}\n\nfunc ReadVarInt(r io.Reader) (uint64, error) {\n    var p [1]byte\n    if _, err := io.ReadFull(r, p[:]); err != nil { return 0, err }\n    switch p[0] {\n    case 0xfd:\n        var x uint16; _ = binary.Read(r, binary.LittleEndian, &x); return uint64(x), nil\n    case 0xfe:\n        var x uint32; _ = binary.Read(r, binary.LittleEndian, &x); return uint64(x), nil\n    case 0xff:\n        var x uint64; _ = binary.Read(r, binary.LittleEndian, &x); return x, nil\n    default:\n        return uint64(p[0]), nil\n    }\n}\n"})}),"\n",(0,r.jsx)(i.h3,{id:"\u5e38\u89c1\u9677\u9631",children:"\u5e38\u89c1\u9677\u9631"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"\u5c06 marker/flag \u9519\u5f53\u4f5c\u8f93\u5165\u6570\u91cf\uff08\u5bfc\u81f4\u89e3\u6790\u9519\u4f4d\uff09"}),"\n",(0,r.jsx)(i.li,{children:"\u8bef\u7528 wtxid \u4f5c\u4e3a\u4ea4\u6613\u5f15\u7528\uff08\u94fe\u4e0a outpoint \u4f7f\u7528 txid\uff09"}),"\n",(0,r.jsx)(i.li,{children:"scriptSig \u4e0e witness \u653e\u7f6e\u4f4d\u7f6e\u6df7\u6dc6\uff08\u5c24\u5176\u662f P2SH-P2WPKH\uff09"}),"\n"]})]})}function x(n={}){const{wrapper:i}={...(0,s.R)(),...n.components};return i?(0,r.jsx)(i,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}},28453:(n,i,e)=>{e.d(i,{R:()=>c,x:()=>l});var t=e(96540);const r={},s=t.createContext(r);function c(n){const i=t.useContext(s);return t.useMemo((function(){return"function"==typeof n?n(i):{...i,...n}}),[i,n])}function l(n){let i;return i=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),t.createElement(s.Provider,{value:i},n.children)}}}]);
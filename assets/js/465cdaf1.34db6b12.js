"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[4819],{24442:(e,l,n)=>{n.r(l),n.d(l,{assets:()=>o,contentTitle:()=>d,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"Wiki/programming/rust/memory/interior-mutability","title":"interior-mutability","description":"\u5185\u90e8\u53ef\u53d8\u6027\uff1aUnsafeCell\u3001Cell\u3001RefCell","source":"@site/docs/Wiki/programming/rust/memory/interior-mutability.md","sourceDirName":"Wiki/programming/rust/memory","slug":"/Wiki/programming/rust/memory/interior-mutability","permalink":"/docs/Wiki/programming/rust/memory/interior-mutability","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"drop-unwind-abort","permalink":"/docs/Wiki/programming/rust/memory/drop-unwind-abort"},"next":{"title":"layout-repr-niches","permalink":"/docs/Wiki/programming/rust/memory/layout-repr-niches"}}');var i=n(74848),c=n(28453);const s={},d=void 0,o={},t=[{value:"\u5185\u90e8\u53ef\u53d8\u6027\uff1aUnsafeCell\u3001Cell\u3001RefCell",id:"\u5185\u90e8\u53ef\u53d8\u6027unsafecellcellrefcell",level:3},{value:"UnsafeCell\uff1a\u6253\u7834\u5171\u4eab\u4e0d\u53ef\u53d8\u7684\u552f\u4e00\u5408\u6cd5\u65b9\u5f0f",id:"unsafecell\u6253\u7834\u5171\u4eab\u4e0d\u53ef\u53d8\u7684\u552f\u4e00\u5408\u6cd5\u65b9\u5f0f",level:4},{value:"Cell \u4e0e Copy \u8bed\u4e49",id:"cell-\u4e0e-copy-\u8bed\u4e49",level:4},{value:"RefCell \u4e0e\u8fd0\u884c\u65f6\u501f\u7528\u68c0\u67e5",id:"refcell-\u4e0e\u8fd0\u884c\u65f6\u501f\u7528\u68c0\u67e5",level:4},{value:"\u7ebf\u7a0b\u5b89\u5168\u4e0e\u5e76\u53d1\u7248\u672c",id:"\u7ebf\u7a0b\u5b89\u5168\u4e0e\u5e76\u53d1\u7248\u672c",level:4},{value:"\u5178\u578b\u7528\u6cd5",id:"\u5178\u578b\u7528\u6cd5",level:4},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:4}];function a(e){const l={code:"code",h3:"h3",h4:"h4",li:"li",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.h3,{id:"\u5185\u90e8\u53ef\u53d8\u6027unsafecellcellrefcell",children:"\u5185\u90e8\u53ef\u53d8\u6027\uff1aUnsafeCell\u3001Cell\u3001RefCell"}),"\n",(0,i.jsx)(l.h4,{id:"unsafecell\u6253\u7834\u5171\u4eab\u4e0d\u53ef\u53d8\u7684\u552f\u4e00\u5408\u6cd5\u65b9\u5f0f",children:"UnsafeCell\uff1a\u6253\u7834\u5171\u4eab\u4e0d\u53ef\u53d8\u7684\u552f\u4e00\u5408\u6cd5\u65b9\u5f0f"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:["\u6807\u51c6\u5e93\u5185\u90e8\uff08\u5982 ",(0,i.jsx)(l.code,{children:"Cell/RefCell/Mutex/RwLock"}),"\uff09\u90fd\u4ee5 ",(0,i.jsx)(l.code,{children:"UnsafeCell<T>"})," \u5305\u88c5\u4ee5\u652f\u6301\u5728 ",(0,i.jsx)(l.code,{children:"&T"})," \u4e0b\u4fee\u6539\u5185\u90e8\u6570\u636e\u3002"]}),"\n"]}),"\n",(0,i.jsx)(l.h4,{id:"cell-\u4e0e-copy-\u8bed\u4e49",children:"Cell \u4e0e Copy \u8bed\u4e49"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"Cell<T>"})," \u63d0\u4f9b\u6309\u503c get/set \u7684\u5185\u90e8\u53ef\u53d8\u6027\uff0c\u8981\u6c42 ",(0,i.jsx)(l.code,{children:"T: Copy"}),"\uff08\u6216\u4f7f\u7528 ",(0,i.jsx)(l.code,{children:"take/replace"}),"\uff09\u3002"]}),"\n"]}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-rust",children:"use std::cell::Cell;\nlet x = Cell::new(1);\nx.set(2);\nassert_eq!(x.get(), 2);\n"})}),"\n",(0,i.jsx)(l.h4,{id:"refcell-\u4e0e\u8fd0\u884c\u65f6\u501f\u7528\u68c0\u67e5",children:"RefCell \u4e0e\u8fd0\u884c\u65f6\u501f\u7528\u68c0\u67e5"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"RefCell<T>"})," \u63d0\u4f9b ",(0,i.jsx)(l.code,{children:"borrow()/borrow_mut()"}),"\uff0c\u5728\u8fd0\u884c\u65f6\u5f3a\u5236\u201c\u591a\u8bfb\u6216\u72ec\u5199\u201d\u7684\u501f\u7528\u89c4\u5219\uff0c\u8fdd\u89c4\u89e6\u53d1 panic\u3002"]}),"\n"]}),"\n",(0,i.jsx)(l.pre,{children:(0,i.jsx)(l.code,{className:"language-rust",children:"use std::cell::RefCell;\nlet v = RefCell::new(vec![1]);\n{\n    let mut r = v.borrow_mut();\n    r.push(2);\n}\nassert_eq!(v.borrow().len(), 2);\n"})}),"\n",(0,i.jsx)(l.h4,{id:"\u7ebf\u7a0b\u5b89\u5168\u4e0e\u5e76\u53d1\u7248\u672c",children:"\u7ebf\u7a0b\u5b89\u5168\u4e0e\u5e76\u53d1\u7248\u672c"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"Cell/RefCell"})," \u975e\u7ebf\u7a0b\u5b89\u5168\uff0c\u4e0d\u662f ",(0,i.jsx)(l.code,{children:"Sync"}),"\uff1b"]}),"\n",(0,i.jsxs)(l.li,{children:["\u5e76\u53d1\u4e0b\u4f7f\u7528 ",(0,i.jsx)(l.code,{children:"Mutex<T>"}),"\u3001",(0,i.jsx)(l.code,{children:"RwLock<T>"}),"\u3001",(0,i.jsx)(l.code,{children:"Atomic*"})," \u6216 ",(0,i.jsx)(l.code,{children:"parking_lot"})," \u66ff\u4ee3\uff1b"]}),"\n",(0,i.jsxs)(l.li,{children:["\u8de8\u7ebf\u7a0b\u5171\u4eab\u9700\u914d\u5408 ",(0,i.jsx)(l.code,{children:"Arc<T>"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsx)(l.h4,{id:"\u5178\u578b\u7528\u6cd5",children:"\u5178\u578b\u7528\u6cd5"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsx)(l.li,{children:"\u9762\u5411\u5bf9\u8c61\u6837\u5f0f\u7684\u81ea\u5f15\u7528/\u56de\u8c03\u7f13\u5b58\uff1b"}),"\n",(0,i.jsxs)(l.li,{children:["\u60f0\u6027\u521d\u59cb\u5316\uff08",(0,i.jsx)(l.code,{children:"OnceCell"}),"/",(0,i.jsx)(l.code,{children:"Lazy"}),"\uff09\uff1b"]}),"\n",(0,i.jsxs)(l.li,{children:["\u5168\u5c40\u72b6\u6001\u7ba1\u7406\uff08",(0,i.jsx)(l.code,{children:"OnceLock"})," + ",(0,i.jsx)(l.code,{children:"Arc"}),"\uff09\u3002"]}),"\n"]}),"\n",(0,i.jsx)(l.h4,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,i.jsxs)(l.ul,{children:["\n",(0,i.jsxs)(l.li,{children:[(0,i.jsx)(l.code,{children:"RefCell"})," \u501f\u7528\u8ba1\u6570\u7684 panic \u4f1a poison \u5bb9\u5668\uff08\u5bf9 ",(0,i.jsx)(l.code,{children:"Mutex"})," \u800c\u8a00\uff09\uff0c\u9700\u8003\u8651\u6062\u590d\u7b56\u7565\uff1b"]}),"\n",(0,i.jsxs)(l.li,{children:["\u5728 async \u73af\u5883\u4f7f\u7528 ",(0,i.jsx)(l.code,{children:"Mutex"})," \u65f6\u907f\u514d\u6301\u9501 ",(0,i.jsx)(l.code,{children:".await"}),"\uff0c\u4ee5\u9632\u6b7b\u9501\u6216\u4f18\u5148\u7ea7\u53cd\u8f6c\u3002"]}),"\n"]})]})}function u(e={}){const{wrapper:l}={...(0,c.R)(),...e.components};return l?(0,i.jsx)(l,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453:(e,l,n)=>{n.d(l,{R:()=>s,x:()=>d});var r=n(96540);const i={},c=r.createContext(i);function s(e){const l=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(l):{...l,...e}}),[l,e])}function d(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(c.Provider,{value:l},e.children)}}}]);
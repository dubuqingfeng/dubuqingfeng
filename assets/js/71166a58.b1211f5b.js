"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[7602],{35700:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>t});const c=JSON.parse('{"id":"Wiki/programming/java/concurrency/lock","title":"lock","description":"\u9501\u4e0e\u540c\u6b65\uff08synchronized/Lock\uff09","source":"@site/docs/Wiki/programming/java/concurrency/lock.md","sourceDirName":"Wiki/programming/java/concurrency","slug":"/Wiki/programming/java/concurrency/lock","permalink":"/docs/Wiki/programming/java/concurrency/lock","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"completablefuture","permalink":"/docs/Wiki/programming/java/concurrency/completablefuture"},"next":{"title":"thread","permalink":"/docs/Wiki/programming/java/concurrency/thread"}}');var l=i(74848),r=i(28453);const o={},s=void 0,d={},t=[{value:"\u9501\u4e0e\u540c\u6b65\uff08synchronized/Lock\uff09",id:"\u9501\u4e0e\u540c\u6b65synchronizedlock",level:3},{value:"ToC",id:"toc",level:4},{value:"synchronized \u4e0e Monitor",id:"synchronized-\u4e0e-monitor",level:4},{value:"ReentrantLock/Condition/AQS",id:"reentrantlockconditionaqs",level:4},{value:"\u8bfb\u5199\u9501\u4e0e StampedLock",id:"\u8bfb\u5199\u9501\u4e0e-stampedlock",level:4},{value:"wait/notify \u4e0e\u6761\u4ef6\u961f\u5217",id:"waitnotify-\u4e0e\u6761\u4ef6\u961f\u5217",level:4},{value:"\u516c\u5e73\u6027\u3001\u81ea\u65cb\u4e0e\u6027\u80fd",id:"\u516c\u5e73\u6027\u81ea\u65cb\u4e0e\u6027\u80fd",level:4}];function a(n){const e={code:"code",h3:"h3",h4:"h4",li:"li",pre:"pre",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h3,{id:"\u9501\u4e0e\u540c\u6b65synchronizedlock",children:"\u9501\u4e0e\u540c\u6b65\uff08synchronized/Lock\uff09"}),"\n",(0,l.jsx)(e.h4,{id:"toc",children:"ToC"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"synchronized \u4e0e Monitor"}),"\n",(0,l.jsx)(e.li,{children:"ReentrantLock/Condition/AQS"}),"\n",(0,l.jsx)(e.li,{children:"\u8bfb\u5199\u9501\u4e0e StampedLock"}),"\n",(0,l.jsx)(e.li,{children:"wait/notify \u4e0e\u6761\u4ef6\u961f\u5217"}),"\n",(0,l.jsx)(e.li,{children:"\u516c\u5e73\u6027\u3001\u81ea\u65cb\u4e0e\u6027\u80fd"}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"synchronized-\u4e0e-monitor",children:"synchronized \u4e0e Monitor"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u8fdb\u5165/\u9000\u51fa ",(0,l.jsx)(e.code,{children:"synchronized"})," \u5757\u5bf9\u5e94\u83b7\u53d6/\u91ca\u653e\u5bf9\u8c61\u76d1\u89c6\u5668\uff08Monitor\uff09\uff0c\u5177\u6709\u53ef\u91cd\u5165\u6027\u4e0e\u5185\u5b58\u8bed\u4e49\uff1a","\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u89e3\u9501\u5bf9\u540c\u4e00\u5bf9\u8c61\u540e\uff0c\u5bf9\u5e94\u7684\u5199\u5165\u5bf9\u540e\u7eed\u52a0\u9501\u7684\u7ebf\u7a0b\u53ef\u89c1\uff08happens-before\uff09\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u9501\u4f18\u5316\uff08JDK8 \u8bed\u5883\u4e0b\uff09\uff1a\u504f\u5411\u9501\uff08\u5df2\u5728\u65b0\u7248\u672c\u79fb\u9664\uff09\u3001\u8f7b\u91cf\u7ea7\u9501\uff08\u81ea\u65cb+CAS\uff09\u3001\u91cd\u91cf\u7ea7\u9501\uff08\u963b\u585e\uff09\u3002"}),"\n",(0,l.jsx)(e.li,{children:"\u7f16\u8bd1\u5668\u53ef\u80fd\u8fdb\u884c\u9501\u6d88\u9664\uff08\u9003\u9038\u5206\u6790\uff09\u4e0e\u9501\u7c97\u5316\uff08\u5408\u5e76\u76f8\u90bb\u5c0f\u9501\uff09\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"reentrantlockconditionaqs",children:"ReentrantLock/Condition/AQS"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"ReentrantLock"})," \u7b49\u57fa\u4e8e AQS\uff08AbstractQueuedSynchronizer\uff09\u5b9e\u73b0\uff1a","\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4f7f\u7528 CLH \u540c\u6b65\u961f\u5217 + CAS \u7ba1\u7406\u83b7\u53d6/\u91ca\u653e\uff1b\u652f\u6301\u516c\u5e73/\u975e\u516c\u5e73\u7b56\u7565\u3002"}),"\n",(0,l.jsxs)(e.li,{children:["\u53ef\u7528 ",(0,l.jsx)(e.code,{children:"Condition"})," \u83b7\u5f97\u72ec\u7acb\u7684\u7b49\u5f85\u961f\u5217\uff0c\u66ff\u4ee3 ",(0,l.jsx)(e.code,{children:"wait/notify"})," \u7684\u591a\u6761\u4ef6\u573a\u666f\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u76f8\u6bd4 ",(0,l.jsx)(e.code,{children:"synchronized"}),"\uff1a","\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u529f\u80fd\u66f4\u4e30\u5bcc\uff08\u53ef\u8f6e\u8be2 ",(0,l.jsx)(e.code,{children:"tryLock"}),"\u3001\u53ef\u4e2d\u65ad\u9501\u83b7\u53d6\u3001\u6761\u4ef6\u961f\u5217\u3001\u591a\u9501\u7ec4\u5408\uff09\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:["API \u6210\u672c\u66f4\u9ad8\uff0c\u9700\u8981\u663e\u5f0f ",(0,l.jsx)(e.code,{children:"unlock()"}),"\uff0c\u63a8\u8350 try-finally\uff1a"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"Lock lock = new ReentrantLock();\ntry {\n  lock.lock();\n  // \u4e34\u754c\u533a\n} finally {\n  lock.unlock();\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u8bfb\u5199\u9501\u4e0e-stampedlock",children:"\u8bfb\u5199\u9501\u4e0e StampedLock"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"ReadWriteLock"}),"\uff08\u5982 ",(0,l.jsx)(e.code,{children:"ReentrantReadWriteLock"}),"\uff09\uff1a\u8bfb\u591a\u5199\u5c11\u9002\u7528\uff1b\u8bfb\u9501\u5171\u4eab\u3001\u5199\u9501\u72ec\u5360\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"StampedLock"}),"\uff1a\u63d0\u4f9b\u4e50\u89c2\u8bfb\uff08\u65e0\u963b\u585e\u3001\u6821\u9a8c\u6233\uff09\uff0c\u9002\u5408\u8bfb\u591a\u5199\u5c11\u4e14\u5bb9\u5fcd\u91cd\u8bd5\u7684\u573a\u666f\uff1b\u6ce8\u610f API \u4e0d\u53ef\u91cd\u5165\uff0c\u6613\u8bef\u7528\u9700\u5c0f\u5fc3\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"StampedLock sl = new StampedLock();\nlong stamp = sl.tryOptimisticRead();\nint x = this.x; int y = this.y;\nif (!sl.validate(stamp)) {\n  stamp = sl.readLock();\n  try { x = this.x; y = this.y; } finally { sl.unlockRead(stamp); }\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"waitnotify-\u4e0e\u6761\u4ef6\u961f\u5217",children:"wait/notify \u4e0e\u6761\u4ef6\u961f\u5217"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"wait/notify/notifyAll"})," \u5fc5\u987b\u5728\u6301\u6709\u5bf9\u8c61\u76d1\u89c6\u5668\u65f6\u8c03\u7528\uff1b",(0,l.jsx)(e.code,{children:"wait()"})," \u4f1a\u91ca\u653e\u76d1\u89c6\u5668\u5e76\u8fdb\u5165\u7b49\u5f85\u961f\u5217\uff0c\u76f4\u5230\u88ab ",(0,l.jsx)(e.code,{children:"notify"})," \u5524\u9192\u91cd\u65b0\u7ade\u4e89\u9501\u3002"]}),"\n",(0,l.jsx)(e.li,{children:"\u53ef\u80fd\u51fa\u73b0\u4f2a\u5524\u9192\uff0c\u4f7f\u7528\u300c\u6761\u4ef6\u5faa\u73af\u300d\u6a21\u5f0f\uff1a"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"synchronized (lock) {\n  while (!condition) { lock.wait(); }\n  // \u6761\u4ef6\u6ee1\u8db3\n}\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4e0e ",(0,l.jsx)(e.code,{children:"Condition"})," \u5bf9\u6bd4\uff1a\u540e\u8005\u53ef\u4e3a\u4e0d\u540c\u6761\u4ef6\u7ef4\u62a4\u72ec\u7acb\u961f\u5217\uff0c\u907f\u514d\u201c\u60ca\u7fa4\u201d\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"\u516c\u5e73\u6027\u81ea\u65cb\u4e0e\u6027\u80fd",children:"\u516c\u5e73\u6027\u3001\u81ea\u65cb\u4e0e\u6027\u80fd"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u516c\u5e73\u9501\u4fdd\u8bc1\u5148\u6765\u5148\u5f97\uff0c\u907f\u514d\u9965\u997f\uff0c\u4f46\u541e\u5410\u964d\u4f4e\uff1b\u975e\u516c\u5e73\u9501\u503e\u5411\u590d\u7528\u6301\u6709\u8005\uff0c\u63d0\u9ad8\u541e\u5410\u3002"}),"\n",(0,l.jsx)(e.li,{children:"\u5728\u8f7b\u5ea6\u7ade\u4e89\u4e0b\u81ea\u65cb\u83b7\u53d6\u9501\u53ef\u51cf\u5c11\u963b\u585e\u4e0a\u4e0b\u6587\u5207\u6362\uff1b\u5f3a\u7ade\u4e89\u4e0b\u81ea\u65cb\u6d6a\u8d39 CPU\uff0c\u5e94\u5feb\u901f\u6302\u8d77\u3002"}),"\n",(0,l.jsxs)(e.li,{children:["\u6307\u6807\u89c2\u6d4b\uff1a\u7ed3\u5408 ",(0,l.jsx)(e.code,{children:"jfr"}),"/",(0,l.jsx)(e.code,{children:"jcmd"}),"/",(0,l.jsx)(e.code,{children:"jstack"})," \u5206\u6790\u9501\u7ade\u4e89\u3001\u963b\u585e\u70ed\u70b9\uff0c\u5fc5\u8981\u65f6\u8c03\u6574\u9501\u7c92\u5ea6\u6216\u91c7\u7528\u65e0\u9501/\u5206\u6bb5\u7b56\u7565\u3002"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>o,x:()=>s});var c=i(96540);const l={},r=c.createContext(l);function o(n){const e=c.useContext(r);return c.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:o(n.components),c.createElement(r.Provider,{value:e},n.children)}}}]);
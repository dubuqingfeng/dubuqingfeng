"use strict";(globalThis.webpackChunkdubuqingfeng=globalThis.webpackChunkdubuqingfeng||[]).push([[3678],{28453:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>c});var t=n(96540);const r={},s=t.createContext(r);function a(e){const i=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:i},e.children)}},30614:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Wiki/programming/database/clickhouse/partitions-shards-replication","title":"\u5206\u533a/\u5206\u7247/\u526f\u672c","description":"ClickHouse \u7684\u6c34\u5e73\u6269\u5c55\u4e0e\u9ad8\u53ef\u7528\u4f9d\u8d56\u5206\u533a\u3001\u5206\u7247\u4e0e\u526f\u672c\u534f\u4f5c\u3002","source":"@site/docs/Wiki/programming/database/clickhouse/partitions-shards-replication.md","sourceDirName":"Wiki/programming/database/clickhouse","slug":"/Wiki/programming/database/clickhouse/partitions-shards-replication","permalink":"/docs/Wiki/programming/database/clickhouse/partitions-shards-replication","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"\u5206\u533a/\u5206\u7247/\u526f\u672c"},"sidebar":"tutorialSidebar","previous":{"title":"Kafka \u4e0e\u7269\u5316\u89c6\u56fe\u6444\u5165","permalink":"/docs/Wiki/programming/database/clickhouse/kafka-mv"},"next":{"title":"\u4e3b\u952e/\u6392\u5e8f\u952e\u4e0e\u7a00\u758f\u7d22\u5f15","permalink":"/docs/Wiki/programming/database/clickhouse/primary-index"}}');var r=n(74848),s=n(28453);const a={title:"\u5206\u533a/\u5206\u7247/\u526f\u672c"},c=void 0,o={},l=[{value:"\u5206\u533a\uff08Partition\uff09",id:"\u5206\u533apartition",level:2},{value:"\u5206\u7247\u4e0e\u526f\u672c",id:"\u5206\u7247\u4e0e\u526f\u672c",level:2},{value:"\u5efa\u8868\u793a\u4f8b\uff08\u590d\u5236\uff09",id:"\u5efa\u8868\u793a\u4f8b\u590d\u5236",level:2}];function d(e){const i={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.p,{children:"ClickHouse \u7684\u6c34\u5e73\u6269\u5c55\u4e0e\u9ad8\u53ef\u7528\u4f9d\u8d56\u5206\u533a\u3001\u5206\u7247\u4e0e\u526f\u672c\u534f\u4f5c\u3002"}),"\n",(0,r.jsx)(i.h2,{id:"\u5206\u533apartition",children:"\u5206\u533a\uff08Partition\uff09"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\u901a\u8fc7 ",(0,r.jsx)(i.code,{children:"PARTITION BY"})," \u5b9a\u4e49\uff1b\u5e38\u7528\u6309\u6708/\u65e5\u5206\u533a\uff1a",(0,r.jsx)(i.code,{children:"toYYYYMM(ts)"}),"\u3002"]}),"\n",(0,r.jsx)(i.li,{children:"\u652f\u6301\u6309\u5206\u533a\u7ea7\u522b TTL \u6e05\u7406\u3001ALTER \u79fb\u52a8/\u5408\u5e76\u5206\u533a\u3002"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"\u5206\u7247\u4e0e\u526f\u672c",children:"\u5206\u7247\u4e0e\u526f\u672c"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\u5206\u7247\uff08Shard\uff09\uff1a\u6c34\u5e73\u5206\u5e03\u5230\u591a\u53f0\u8282\u70b9\uff1b\u901a\u8fc7 ",(0,r.jsx)(i.code,{children:"Distributed"})," \u5f15\u64ce\u8def\u7531\u3002"]}),"\n",(0,r.jsxs)(i.li,{children:["\u526f\u672c\uff08Replica\uff09\uff1a\u540c\u4e00\u5206\u7247\u7684\u5197\u4f59\uff1b",(0,r.jsx)(i.code,{children:"ReplicatedMergeTree"})," \u901a\u8fc7 keeper \u540c\u6b65\u3002"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"\u5efa\u8868\u793a\u4f8b\u590d\u5236",children:"\u5efa\u8868\u793a\u4f8b\uff08\u590d\u5236\uff09"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sql",children:"CREATE TABLE events_rep (...)\nENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/events', '{replica}')\nPARTITION BY toYYYYMM(ts)\nORDER BY (user_id, ts);\n\nCREATE TABLE events_dist AS events_rep\nENGINE = Distributed(cluster_name, db, events_rep, rand());\n"})})]})}function u(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);
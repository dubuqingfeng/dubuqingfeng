"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[9452],{98943:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>d,default:()=>_,frontMatter:()=>a,metadata:()=>o,toc:()=>p});const o=JSON.parse('{"id":"life/devices/nas/docker/dootask/dootask","title":"dootask","description":"dootask","source":"@site/docs/life/devices/nas/docker/dootask/dootask.md","sourceDirName":"life/devices/nas/docker/dootask","slug":"/life/devices/nas/docker/dootask/","permalink":"/docs/life/devices/nas/docker/dootask/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"crawlab","permalink":"/docs/life/devices/nas/docker/crawlab/"},"next":{"title":"dufs","permalink":"/docs/life/devices/nas/docker/dufs/"}}');var s=r(74848),t=r(28453);const a={},d=void 0,i={},p=[{value:"dootask",id:"dootask",level:2}];function c(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"dootask",children:"dootask"}),"\n",(0,s.jsx)(n.p,{children:"nginx:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-nginx",children:'map $http_upgrade $connection_upgrade {\n    default upgrade;\n    \'\'      close;\n}\nmap $http_host $this_host {\n    "" $host;\n    default $http_host;\n}\nmap $http_x_forwarded_proto $the_scheme {\n     default $http_x_forwarded_proto;\n     "" $scheme;\n}\nmap $http_x_forwarded_host $the_host {\n    default $http_x_forwarded_host;\n    "" $this_host;\n}\nupstream service {\n    server php:20000 weight=5 max_fails=3 fail_timeout=30s;\n    keepalive 16;\n}\nserver {\n    listen 80;\n\n    include /etc/nginx/conf.d/site/*.conf;\n\n    root /var/www/public;\n\n    client_max_body_size  1024M;\n\n    autoindex off;\n    index index.html index.htm index.php;\n\n    charset utf-8;\n\n    location / {\n        try_files $uri @laravels;\n    }\n\n    location ~ \\.well-known{\n        allow all;\n    }\n\n    location =/ws {\n        proxy_http_version 1.1;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Real-PORT $remote_port;\n        proxy_set_header X-Forwarded-Host $the_host;\n        proxy_set_header X-Forwarded-Proto $the_scheme;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header Scheme $scheme;\n        proxy_set_header Server-Protocol $server_protocol;\n        proxy_set_header Server-Name $server_name;\n        proxy_set_header Server-Addr $server_addr;\n        proxy_set_header Server-Port $server_port;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $connection_upgrade;\n        proxy_read_timeout 600s;\n        proxy_send_timeout 600s;\n        proxy_pass http://service;\n    }\n\n    location @laravels {\n        proxy_http_version 1.1;\n        proxy_set_header Connection "";\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Real-PORT $remote_port;\n        proxy_set_header X-Forwarded-Host $the_host;\n        proxy_set_header X-Forwarded-Proto $the_scheme;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header Scheme $scheme;\n        proxy_set_header Server-Protocol $server_protocol;\n        proxy_set_header Server-Name $server_name;\n        proxy_set_header Server-Addr $server_addr;\n        proxy_set_header Server-Port $server_port;\n        proxy_pass http://service;\n    }\n}\n\ninclude /etc/nginx/conf.d/conf.d/*.conf;\n'})}),"\n",(0,s.jsx)(n.p,{children:"docker-compose:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'services:\n  php:\n    container_name: "dootask-php-${APP_ID}"\n    image: "kuaifan/php:swoole-8.0.rc14"\n    shm_size: "2gb"\n    ulimits:\n      core:\n        soft: 0\n        hard: 0\n    volumes:\n      - ./docker/crontab/crontab.conf:/etc/supervisor/conf.d/crontab.conf\n      - ./docker/php/php.conf:/etc/supervisor/conf.d/php.conf\n      - ./docker/php/php.ini:/usr/local/etc/php/php.ini\n      - ./docker/log/supervisor:/var/log/supervisor\n      - ./:/var/www\n    environment:\n      LANG: "C.UTF-8"\n      MODE: "production"\n      MYSQL_HOST: "${DB_HOST}"\n      MYSQL_PORT: "${DB_PORT}"\n      MYSQL_DB_NAME: "${DB_DATABASE}"\n      MYSQL_USERNAME: "${DB_USERNAME}"\n      MYSQL_PASSWORD: "${DB_PASSWORD}"\n    networks:\n      extnetwork:\n        ipv4_address: "${APP_IPPR}.2"\n    depends_on:\n      - redis\n      - mariadb\n    restart: unless-stopped\n\n  nginx:\n    container_name: "dootask-nginx-${APP_ID}"\n    image: "nginx:alpine"\n    ports:\n      - "${APP_PORT}:80"\n      - "${APP_SSL_PORT:-}:443"\n    volumes:\n      - ./docker/nginx:/etc/nginx/conf.d\n      - ./public:/var/www/public\n    networks:\n      extnetwork:\n        ipv4_address: "${APP_IPPR}.3"\n    links:\n      - php\n      # - office\n      # - fileview\n      # - drawio-webapp\n      # - drawio-export\n      # - minder\n      - okr\n      # - ai\n    restart: unless-stopped\n\n  redis:\n    container_name: "dootask-redis-${APP_ID}"\n    image: "redis:alpine"\n    networks:\n      extnetwork:\n        ipv4_address: "${APP_IPPR}.4"\n    restart: unless-stopped\n\n  mariadb:\n    container_name: "dootask-mariadb-${APP_ID}"\n    image: "mariadb:10.7.3"\n    ports:\n      - "${DB_OPEN_PORT:-}:3306"\n    volumes:\n      - ./docker/mysql/repassword.sh:/etc/mysql/repassword.sh\n      - ./docker/mysql/conf.d:/etc/mysql/conf.d\n      - ./docker/mysql/data:/var/lib/mysql\n    environment:\n      MYSQL_PREFIX: "${DB_PREFIX}"\n      MYSQL_ROOT_PASSWORD: "${DB_ROOT_PASSWORD}"\n      MYSQL_DATABASE: "${DB_DATABASE}"\n      MYSQL_USER: "${DB_USERNAME}"\n      MYSQL_PASSWORD: "${DB_PASSWORD}"\n    networks:\n      extnetwork:\n        ipv4_address: "${APP_IPPR}.5"\n    restart: unless-stopped\n\n  # office:\n  #   container_name: "dootask-office-${APP_ID}"\n  #   image: "onlyoffice/documentserver:7.5.1.1"\n  #   volumes:\n  #     - ./docker/office/logs:/var/log/onlyoffice\n  #     - ./docker/office/data:/var/www/onlyoffice/Data\n  #     - ./docker/office/resources/require.js:/var/www/onlyoffice/documentserver/web-apps/vendor/requirejs/require.js\n  #     - ./docker/office/resources/documenteditor/main/resources/css/app.css:/var/www/onlyoffice/documentserver/web-apps/apps/documenteditor/main/resources/css/app.css\n  #     - ./docker/office/resources/documenteditor/mobile/css/964.css:/var/www/onlyoffice/documentserver/web-apps/apps/documenteditor/mobile/css/964.css\n  #     - ./docker/office/resources/presentationeditor/main/resources/css/app.css:/var/www/onlyoffice/documentserver/web-apps/apps/presentationeditor/main/resources/css/app.css\n  #     - ./docker/office/resources/presentationeditor/mobile/css/612.css:/var/www/onlyoffice/documentserver/web-apps/apps/presentationeditor/mobile/css/612.css\n  #     - ./docker/office/resources/spreadsheeteditor/main/resources/css/app.css:/var/www/onlyoffice/documentserver/web-apps/apps/spreadsheeteditor/main/resources/css/app.css\n  #     - ./docker/office/resources/spreadsheeteditor/mobile/css/887.css:/var/www/onlyoffice/documentserver/web-apps/apps/spreadsheeteditor/mobile/css/887.css\n  #   environment:\n  #     JWT_SECRET: ${APP_KEY}\n  #   networks:\n  #     extnetwork:\n  #       ipv4_address: "${APP_IPPR}.6"\n  #   restart: unless-stopped\n\n  # fileview:\n  #   container_name: "dootask-fileview-${APP_ID}"\n  #   image: "kuaifan/fileview:4.2.0-SNAPSHOT-RC25"\n  #   environment:\n  #     KK_CONTEXT_PATH: "/fileview"\n  #     KK_OFFICE_PREVIEW_SWITCH_DISABLED: true\n  #     KK_FILE_UPLOAD_ENABLED: true\n  #     KK_MEDIA: "mp3,wav,mp4,mov,avi,wmv"\n  #   networks:\n  #     extnetwork:\n  #       ipv4_address: "${APP_IPPR}.7"\n  #   restart: unless-stopped\n\n  # drawio-webapp:\n  #   container_name: "dootask-drawio-webapp-${APP_ID}"\n  #   image: "jgraph/drawio:20.8.20"\n  #   volumes:\n  #     - ./docker/drawio/webapp/index.html:/usr/local/tomcat/webapps/draw/index.html\n  #     - ./docker/drawio/webapp/stencils:/usr/local/tomcat/webapps/draw/stencils\n  #     - ./docker/drawio/webapp/js/app.min.js:/usr/local/tomcat/webapps/draw/js/app.min.js\n  #     - ./docker/drawio/webapp/js/croppie/croppie.min.css:/usr/local/tomcat/webapps/draw/js/croppie/croppie.min.css\n  #     - ./docker/drawio/webapp/js/diagramly/ElectronApp.js:/usr/local/tomcat/webapps/draw/js/diagramly/ElectronApp.js\n  #   networks:\n  #     extnetwork:\n  #       ipv4_address: "${APP_IPPR}.8"\n  #   depends_on:\n  #     - drawio-export\n  #   restart: unless-stopped\n\n  # drawio-export:\n  #   container_name: "dootask-drawio-export-${APP_ID}"\n  #   image: "kuaifan/export-server:0.0.1"\n  #   networks:\n  #     extnetwork:\n  #       ipv4_address: "${APP_IPPR}.9"\n  #   volumes:\n  #     - ./docker/drawio/export/fonts:/usr/share/fonts/drawio\n  #   restart: unless-stopped\n\n  # minder:\n  #   container_name: "dootask-minder-${APP_ID}"\n  #   image: "kuaifan/minder:0.1.3"\n  #   networks:\n  #     extnetwork:\n  #       ipv4_address: "${APP_IPPR}.10"\n  #   restart: unless-stopped\n\n  # approve:\n  #   container_name: "dootask-approve-${APP_ID}"\n  #   image: "kuaifan/dooapprove:0.0.10"\n  #   environment:\n  #     TZ: "${TIMEZONE:-PRC}"\n  #     MYSQL_HOST: "${DB_HOST}"\n  #     MYSQL_PORT: "${DB_PORT}"\n  #     MYSQL_DBNAME: "${DB_DATABASE}"\n  #     MYSQL_USERNAME: "${DB_USERNAME}"\n  #     MYSQL_PASSWORD: "${DB_PASSWORD}"\n  #     MYSQL_Prefix: "${DB_PREFIX}approve_"\n  #     DEMO_DATA: true\n  #     KEY: ${APP_KEY}\n  #   networks:\n  #     extnetwork:\n  #       ipv4_address: "${APP_IPPR}.11"\n  #   depends_on:\n  #     - mariadb\n  #   restart: unless-stopped\n\n  # ai:\n  #   container_name: "dootask-ai-${APP_ID}"\n  #   image: "kuaifan/dooai:0.1.8"\n  #   networks:\n  #     extnetwork:\n  #       ipv4_address: "${APP_IPPR}.12"\n  #   restart: unless-stopped\n\n  # okr:\n  #   container_name: "dootask-okr-${APP_ID}"\n  #   image: "kuaifan/doookr:0.4.2"\n  #   environment:\n  #     TZ: "${TIMEZONE:-PRC}"\n  #     DOO_TASK_URL: "http://${APP_IPPR}.3"\n  #     MYSQL_HOST: "${DB_HOST}"\n  #     MYSQL_PORT: "${DB_PORT}"\n  #     MYSQL_DBNAME: "${DB_DATABASE}"\n  #     MYSQL_USERNAME: "${DB_USERNAME}"\n  #     MYSQL_PASSWORD: "${DB_PASSWORD}"\n  #     MYSQL_PREFIX: "${DB_PREFIX}"\n  #     DEMO_DATA: true\n  #     KEY: ${APP_KEY}\n  #   networks:\n  #     extnetwork:\n  #       ipv4_address: "${APP_IPPR}.13"\n  #   depends_on:\n  #     - mariadb\n  #   restart: unless-stopped\n\nnetworks:\n  extnetwork:\n    name: "dootask-networks-${APP_ID}"\n    ipam:\n      config:\n        - subnet: "${APP_IPPR}.0/24"\n          gateway: "${APP_IPPR}.1"\n'})})]})}function _(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>d});var o=r(96540);const s={},t=o.createContext(s);function a(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);
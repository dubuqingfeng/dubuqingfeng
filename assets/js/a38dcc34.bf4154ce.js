"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[592],{87434:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"Wiki/programming/solidity/security","title":"\u5b89\u5168\u4e0e\u5e38\u89c1\u6f0f\u6d1e","description":"\u5178\u578b\u5b89\u5168\u95ee\u9898\u3001\u68c0\u6d4b\u65b9\u6cd5\u4e0e\u4fee\u590d\u5efa\u8bae\u3002","source":"@site/docs/Wiki/programming/solidity/security.md","sourceDirName":"Wiki/programming/solidity","slug":"/Wiki/programming/solidity/security","permalink":"/docs/Wiki/programming/solidity/security","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"\u5b89\u5168\u4e0e\u5e38\u89c1\u6f0f\u6d1e"},"sidebar":"tutorialSidebar","previous":{"title":"\u5408\u7ea6\u8bbe\u8ba1\u6a21\u5f0f","permalink":"/docs/Wiki/programming/solidity/patterns"},"next":{"title":"\u6d4b\u8bd5\u4e0e\u5de5\u5177\u94fe\uff08Foundry/Hardhat\uff09","permalink":"/docs/Wiki/programming/solidity/testing-tooling"}}');var r=i(74848),s=i(28453);const l={title:"\u5b89\u5168\u4e0e\u5e38\u89c1\u6f0f\u6d1e"},a=void 0,o={},c=[{value:"\u91cd\u5165\u653b\u51fb\u793a\u4f8b\u4e0e\u4fee\u590d",id:"\u91cd\u5165\u653b\u51fb\u793a\u4f8b\u4e0e\u4fee\u590d",level:2}];function d(n){const e={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:"\u5178\u578b\u5b89\u5168\u95ee\u9898\u3001\u68c0\u6d4b\u65b9\u6cd5\u4e0e\u4fee\u590d\u5efa\u8bae\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u91cd\u5165\u653b\u51fb\uff08Reentrancy\uff09\uff1a\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"ReentrancyGuard"}),"\u3001CEI \u987a\u5e8f\u3001\u6700\u5c0f\u6388\u6743\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6388\u6743\u7f3a\u9677\uff1a",(0,r.jsx)(e.code,{children:"approve"})," \u7ade\u6001\u3001\u7b7e\u540d\u91cd\u653e\uff1b\u4f7f\u7528 Permit\u3001\u9632\u91cd\u653e\u57df\u5206\u9694\u4e0e nonce\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:["\u6ea2\u51fa/\u4e0b\u6ea2\uff1a0.8+ \u9ed8\u8ba4\u68c0\u67e5\uff1b\u5386\u53f2\u4ee3\u7801\u6ce8\u610f\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"SafeMath"}),"\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:["\u521d\u59cb\u5316\u4e0e\u4ee3\u7406\uff1a\u4ee3\u7406\u5b9e\u73b0\u5408\u7ea6\u7684 constructor \u4e0d\u4f1a\u88ab\u8c03\u7528\uff1b\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"initializer"}),"/UUPS \u6a21\u5f0f\u3002"]}),"\n",(0,r.jsx)(e.li,{children:"\u968f\u673a\u6027\u4e0e\u9884\u8a00\u673a\uff1a\u94fe\u4e0a\u4f2a\u968f\u673a\u4e0d\u53ef\u7528\uff1b\u4f7f\u7528 VRF/\u9884\u8a00\u673a\u3002"}),"\n",(0,r.jsxs)(e.li,{children:["\u8bbf\u95ee\u63a7\u5236\uff1a",(0,r.jsx)(e.code,{children:"onlyOwner"})," \u6f0f\u6d1e\u3001Timelock\u3001\u4e24\u6b65\u63d0\u6743\u6d41\u7a0b\u3002"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u5de5\u5177\uff1aSlither\u3001Mythril\u3001Echidna/Foundry fuzz\u3001Audit \u6e05\u5355\u4e0e\u6d4b\u8bd5\u8986\u76d6\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u91cd\u5165\u653b\u51fb\u793a\u4f8b\u4e0e\u4fee\u590d",children:"\u91cd\u5165\u653b\u51fb\u793a\u4f8b\u4e0e\u4fee\u590d"}),"\n",(0,r.jsx)(e.p,{children:"\u6613\u53d7\u653b\u51fb\u5408\u7ea6\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-solidity",children:'pragma solidity ^0.8.20;\n\ncontract Vault {\n    mapping(address => uint256) public bal;\n    function deposit() external payable { bal[msg.sender] += msg.value; }\n    function withdraw() external {\n        uint256 amt = bal[msg.sender];\n        require(amt > 0);\n        (bool ok,) = msg.sender.call{value: amt}("");\n        require(ok);\n        bal[msg.sender] = 0; // \u8106\u5f31\uff1a\u5916\u90e8\u8c03\u7528\u524d\u672a\u66f4\u65b0\u72b6\u6001\n    }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u4fee\u590d\uff08CEI + ReentrancyGuard\uff09\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-solidity",children:'import "@openzeppelin/contracts/security/ReentrancyGuard.sol";\ncontract SafeVault is ReentrancyGuard {\n    mapping(address => uint256) public bal;\n    function deposit() external payable { bal[msg.sender] += msg.value; }\n    function withdraw() external nonReentrant {\n        uint256 amt = bal[msg.sender];\n        require(amt > 0);\n        bal[msg.sender] = 0; // \u5148 Effects \u518d Interactions\n        (bool ok,) = msg.sender.call{value: amt}("");\n        require(ok);\n    }\n}\n'})})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>l,x:()=>a});var t=i(96540);const r={},s=t.createContext(r);function l(n){const e=t.useContext(s);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:l(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);
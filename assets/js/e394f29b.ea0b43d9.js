"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[7869],{42787:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>d,contentTitle:()=>s,default:()=>a,frontMatter:()=>t,metadata:()=>l,toc:()=>r});const l=JSON.parse('{"id":"Wiki/blockchain/bitcoin/block/compact","title":"compact","description":"\u7d27\u51d1\u533a\u5757\uff08BIP152\uff09","source":"@site/docs/Wiki/blockchain/bitcoin/block/compact.md","sourceDirName":"Wiki/blockchain/bitcoin/block","slug":"/Wiki/blockchain/bitcoin/block/compact","permalink":"/docs/Wiki/blockchain/bitcoin/block/compact","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"index","permalink":"/docs/Wiki/blockchain/bitcoin/bip/"},"next":{"title":"header","permalink":"/docs/Wiki/blockchain/bitcoin/block/header"}}');var c=i(74848),o=i(28453);const t={},s=void 0,d={},r=[{value:"\u7d27\u51d1\u533a\u5757\uff08BIP152\uff09",id:"\u7d27\u51d1\u533a\u5757bip152",level:2},{value:"\u57fa\u672c\u6d41\u7a0b",id:"\u57fa\u672c\u6d41\u7a0b",level:3},{value:"\u77ed ID \u8ba1\u7b97",id:"\u77ed-id-\u8ba1\u7b97",level:3},{value:"\u4f18\u52bf\u4e0e\u6743\u8861",id:"\u4f18\u52bf\u4e0e\u6743\u8861",level:3},{value:"\u542f\u7528\u4e0e\u534f\u5546",id:"\u542f\u7528\u4e0e\u534f\u5546",level:3},{value:"\u5b9e\u73b0\u63d0\u793a\uff08Go \u4f2a\u4ee3\u7801\uff09",id:"\u5b9e\u73b0\u63d0\u793ago-\u4f2a\u4ee3\u7801",level:3}];function h(n){const e={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.h2,{id:"\u7d27\u51d1\u533a\u5757bip152",children:"\u7d27\u51d1\u533a\u5757\uff08BIP152\uff09"}),"\n",(0,c.jsx)(e.p,{children:"\u7d27\u51d1\u533a\u5757\u901a\u8fc7\u201c\u77ed ID + \u7f3a\u5931\u4ea4\u6613\u6309\u9700\u62c9\u53d6\u201d\u7684\u65b9\u5f0f\u52a0\u901f\u65b0\u533a\u5757\u4f20\u64ad\uff0c\u964d\u4f4e\u5e26\u5bbd\u5e76\u51cf\u5c11\u5b64\u5757\u6982\u7387\u3002"}),"\n",(0,c.jsx)(e.h3,{id:"\u57fa\u672c\u6d41\u7a0b",children:"\u57fa\u672c\u6d41\u7a0b"}),"\n",(0,c.jsxs)(e.ol,{children:["\n",(0,c.jsxs)(e.li,{children:["\u65b0\u533a\u5757\u751f\u6210\u540e\uff0c\u8282\u70b9\u53d1\u9001 ",(0,c.jsx)(e.code,{children:"cmpctblock"}),"\uff1a","\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u5305\u542b\u533a\u5757\u5934\u3001prefilled_tx\uff08\u5c11\u91cf\u5b8c\u6574\u4ea4\u6613\uff0c\u5982 coinbase\uff09\u3001\u77ed ID \u5217\u8868\uff08\u5176\u4f59\u4ea4\u6613\uff09"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(e.li,{children:["\u5bf9\u7aef\u6839\u636e mempool \u5c1d\u8bd5\u91cd\u6784\u5b8c\u6574\u533a\u5757\uff1a","\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u6839\u636e\u77ed ID \u5728\u672c\u5730 mempool \u547d\u4e2d\u4ea4\u6613"}),"\n",(0,c.jsxs)(e.li,{children:["\u672a\u547d\u4e2d\u5219\u4ee5 ",(0,c.jsx)(e.code,{children:"getblocktxn"})," \u8bf7\u6c42\u7f3a\u5931\u4ea4\u6613"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(e.li,{children:["\u53d1\u9001\u65b9\u4ee5 ",(0,c.jsx)(e.code,{children:"blocktxn"})," \u56de\u5e94\u7f3a\u5931\u4ea4\u6613"]}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"\u77ed-id-\u8ba1\u7b97",children:"\u77ed ID \u8ba1\u7b97"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u4f7f\u7528 SipHash-2-4 \u5bf9\u4ea4\u6613\u54c8\u5e0c\uff08wtxid \u6216 txid\uff0c\u5b9e\u9645\u4f7f\u7528 txid\uff1bBIP152 v2 \u53ef\u9009 wtxid\uff09\u505a 6 \u5b57\u8282\u622a\u65ad"}),"\n",(0,c.jsx)(e.li,{children:"SipHash key \u57fa\u4e8e\u533a\u5757\u5934\u4e0e nonce\uff08\u6bcf\u4e2a\u5757\u4e0d\u540c\uff09"}),"\n",(0,c.jsx)(e.li,{children:"\u77ed ID \u51b2\u7a81\u6982\u7387\u4f4e\uff0c\u4f46\u4ecd\u901a\u8fc7 prefilled \u4e0e\u7d22\u5f15\u6821\u9a8c\u89c4\u907f"}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"\u4f18\u52bf\u4e0e\u6743\u8861",children:"\u4f18\u52bf\u4e0e\u6743\u8861"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\u4f18\u52bf\uff1a","\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u964d\u4f4e\u5e26\u5bbd\uff1a\u4ec5\u5c11\u91cf\u4ea4\u6613\u9700\u8981\u5b8c\u6574\u4f20\u8f93"}),"\n",(0,c.jsx)(e.li,{children:"\u964d\u4f4e\u5ef6\u8fdf\uff1a\u66f4\u5feb\u8fbe\u5230\u201c\u8db3\u591f\u91cd\u6784\u201d\u7684\u72b6\u6001"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(e.li,{children:["\u6743\u8861\uff1a","\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u4f9d\u8d56 mempool \u547d\u4e2d\u7387\uff1b\u4e0d\u540c\u8282\u70b9 mempool \u5dee\u5f02\u5bfc\u81f4\u7f3a\u5931\u7387\u6ce2\u52a8"}),"\n",(0,c.jsx)(e.li,{children:"\u9700\u8981\u989d\u5916\u7684\u8bf7\u6c42/\u54cd\u5e94\u5f80\u8fd4\uff08getblocktxn/blocktxn\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"\u542f\u7528\u4e0e\u534f\u5546",children:"\u542f\u7528\u4e0e\u534f\u5546"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\u901a\u8fc7 ",(0,c.jsx)(e.code,{children:"sendcmpct"}),"/",(0,c.jsx)(e.code,{children:"sendheaders"})," \u7b49\u6d88\u606f\u534f\u5546"]}),"\n",(0,c.jsx)(e.li,{children:"\u8282\u70b9\u53ef\u5ba3\u544a\u662f\u5426\u652f\u6301\u7d27\u51d1\u533a\u5757\uff0c\u4ee5\u53ca\u504f\u597d\u7684\u516c\u544a\u6a21\u5f0f"}),"\n"]}),"\n",(0,c.jsx)(e.h3,{id:"\u5b9e\u73b0\u63d0\u793ago-\u4f2a\u4ee3\u7801",children:"\u5b9e\u73b0\u63d0\u793a\uff08Go \u4f2a\u4ee3\u7801\uff09"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-go",children:"type CmpctBlock struct {\n    Header    BlockHeader\n    Nonce     uint64\n    Prefilled []TxWithIndex   // \u5305\u542b coinbase \u7b49\n    ShortIDs  [][]byte        // \u6bcf\u4e2a 6 \u5b57\u8282\n}\n\nfunc ShortID(txid [32]byte, key [16]byte) [6]byte {\n    // SipHash-2-4(txid) \u622a\u65ad\u5230 6 \u5b57\u8282\n}\n\nfunc Reconstruct(cb CmpctBlock, mempool map[[32]byte]*Tx) (*Block, MissingList) {\n    // 1) \u653e\u5165 prefilled\n    // 2) \u7528\u77ed ID \u5728 mempool \u4e2d\u547d\u4e2d\u4ea4\u6613\n    // 3) \u8bb0\u5f55\u672a\u547d\u4e2d\u7d22\u5f15\u7528\u4e8e getblocktxn\n}\n"})})]})}function a(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,c.jsx)(e,{...n,children:(0,c.jsx)(h,{...n})}):h(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>t,x:()=>s});var l=i(96540);const c={},o=l.createContext(c);function t(n){const e=l.useContext(o);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:t(n.components),l.createElement(o.Provider,{value:e},n.children)}}}]);
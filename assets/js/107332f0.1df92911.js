"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[7747],{64397:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>c,toc:()=>a});var r=t(74848),i=t(28453);const l={},s=void 0,c={id:"Wiki/programming/golang/channel/channel",title:"channel",description:"Channel \u901a\u9053",source:"@site/docs/Wiki/programming/golang/channel/channel.md",sourceDirName:"Wiki/programming/golang/channel",slug:"/Wiki/programming/golang/channel/",permalink:"/docs/Wiki/programming/golang/channel/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"cgo",permalink:"/docs/Wiki/programming/golang/cgo/"},next:{title:"chaos",permalink:"/docs/Wiki/programming/golang/chaos/"}},o={},a=[{value:"Channel \u901a\u9053",id:"channel-\u901a\u9053",level:3},{value:"ToC",id:"toc",level:4},{value:"\u6e90\u7801\u5730\u5740",id:"\u6e90\u7801\u5730\u5740",level:4},{value:"\u5185\u90e8\u5b9e\u73b0",id:"\u5185\u90e8\u5b9e\u73b0",level:4},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:4},{value:"nil \u548c\u5173\u95ed",id:"nil-\u548c\u5173\u95ed",level:4},{value:"select \u7684\u539f\u7406",id:"select-\u7684\u539f\u7406",level:4},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:4}];function h(n){const e={a:"a",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h3,{id:"channel-\u901a\u9053",children:"Channel \u901a\u9053"}),"\n",(0,r.jsx)(e.h4,{id:"toc",children:"ToC"}),"\n",(0,r.jsx)(e.h4,{id:"\u6e90\u7801\u5730\u5740",children:"\u6e90\u7801\u5730\u5740"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.a,{href:"https://github.com/golang/go/blob/master/src/runtime/chan.go",children:"https://github.com/golang/go/blob/master/src/runtime/chan.go"})}),"\n",(0,r.jsx)(e.h4,{id:"\u5185\u90e8\u5b9e\u73b0",children:"\u5185\u90e8\u5b9e\u73b0"}),"\n",(0,r.jsx)(e.p,{children:"\u7ef4\u62a4\u4e86\u4e24\u4e2a Goroutine \u961f\u5217\uff0c\u4e00\u4e2a\u662f\u63a5\u6536\u6570\u636e\u7684\uff0c\u4e00\u4e2a\u662f\u53d1\u9001\u6570\u636e\u7684\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"type hchan struct {\r\n\tqcount   uint           // total data in the queue\r\n\tdataqsiz uint           // size of the circular queue\r\n\tbuf      unsafe.Pointer // points to an array of dataqsiz elements\r\n\telemsize uint16\r\n\tclosed   uint32\r\n\telemtype *_type // element type\r\n\tsendx    uint   // send index\r\n\trecvx    uint   // receive index\r\n\trecvq    waitq  // list of recv waiters\r\n\tsendq    waitq  // list of send waiters\r\n\r\n\t// lock protects all fields in hchan, as well as several\r\n\t// fields in sudogs blocked on this channel.\r\n\t//\r\n\t// Do not change another G's status while holding this lock\r\n\t// (in particular, do not ready a G), as this can deadlock\r\n\t// with stack shrinking.\r\n\tlock mutex\r\n}\r\n\r\ntype waitq struct {\r\n\tfirst *sudog\r\n\tlast  *sudog\r\n}\r\n\r\ntype sudog struct{\r\n   g *g\r\n   isSelect bool\r\n   next *sudog\r\n   prev *sudog\r\n   elem unsafe.Pointer //data element\r\n   ...\r\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u6709\u7f13\u51b2\u7684\u5229\u7528\u5faa\u73af\u6570\u7ec4\uff0cbuf \u4e3a\u6307\u5411\u6570\u7ec4\u7684\u6307\u9488\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u65b0\u5efa\u4e00\u4e2a chan \u540e\uff0c\u5185\u5b58\u4f1a\u5728\u5806\u4e0a\u5206\u914d\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u4e0d\u65ad\u8bfb\u53d6 channel"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"for i := range ch {\r\n    fmt.Println(i)\r\n}\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsx)(e.li,{children:"\u5224\u65ad channel \u662f\u5426\u5173\u95ed"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"if v, ok := <- ch; ok {\r\n    fmt.Println(v)\r\n}\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"3",children:["\n",(0,r.jsx)(e.li,{children:"\u4f7f\u7528 select \u8bfb\u53d6\u591a\u4e2a channel"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"for{\r\n    select {\r\n    \tcase <-ch1:\r\n    \t\tprocess1()\r\n    \t\treturn\r\n    \tcase <-ch2:\r\n    \t\tprocess2()\r\n    \t\treturn\r\n    }\r\n}\n"})}),"\n",(0,r.jsx)(e.h4,{id:"nil-\u548c\u5173\u95ed",children:"nil \u548c\u5173\u95ed"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u5411\u4e00\u4e2a nil \u7684 channel \u53d1\u9001\u548c\u63a5\u6536\uff0c\u4f1a\u5bfc\u81f4\u6c38\u8fdc\u963b\u585e"}),"\n",(0,r.jsx)(e.li,{children:"\u5411\u5df2\u7ecf\u5173\u95ed\u7684 channel \u53d1\u9001\uff0c\u4f1a\u5bfc\u81f4 panic"}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"select-\u7684\u539f\u7406",children:"select \u7684\u539f\u7406"}),"\n",(0,r.jsx)(e.h4,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,r.jsx)(e.p,{children:"channel"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.a,{href:"https://tiancaiamao.gitbooks.io/go-internals/content/zh/07.1.html",children:"https://tiancaiamao.gitbooks.io/go-internals/content/zh/07.1.html"})})]})}function d(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(h,{...n})}):h(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>c});var r=t(96540);const i={},l=r.createContext(i);function s(n){const e=r.useContext(l);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:s(n.components),r.createElement(l.Provider,{value:e},n.children)}}}]);
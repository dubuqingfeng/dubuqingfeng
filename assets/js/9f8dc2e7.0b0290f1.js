"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[2997],{63414:(n,e,o)=>{o.r(e),o.d(e,{assets:()=>a,contentTitle:()=>s,default:()=>u,frontMatter:()=>c,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"Wiki/programming/java/concurrency/forkjoin","title":"forkjoin","description":"ForkJoinPool \u4e0e\u5de5\u4f5c\u7a83\u53d6","source":"@site/docs/Wiki/programming/java/concurrency/forkjoin.md","sourceDirName":"Wiki/programming/java/concurrency","slug":"/Wiki/programming/java/concurrency/forkjoin","permalink":"/docs/Wiki/programming/java/concurrency/forkjoin","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"completablefuture","permalink":"/docs/Wiki/programming/java/concurrency/completablefuture"},"next":{"title":"lock","permalink":"/docs/Wiki/programming/java/concurrency/lock"}}');var i=o(74848),l=o(28453);const c={},s=void 0,a={},t=[{value:"ForkJoinPool \u4e0e\u5de5\u4f5c\u7a83\u53d6",id:"forkjoinpool-\u4e0e\u5de5\u4f5c\u7a83\u53d6",level:3},{value:"ToC",id:"toc",level:4},{value:"\u8bbe\u8ba1\u7406\u5ff5\u4e0e\u9002\u7528\u573a\u666f",id:"\u8bbe\u8ba1\u7406\u5ff5\u4e0e\u9002\u7528\u573a\u666f",level:4},{value:"\u57fa\u672c\u7528\u6cd5\uff1aRecursiveTask",id:"\u57fa\u672c\u7528\u6cd5recursivetask",level:4},{value:"\u5de5\u4f5c\u7a83\u53d6\u4e0e\u5e76\u884c\u5ea6",id:"\u5de5\u4f5c\u7a83\u53d6\u4e0e\u5e76\u884c\u5ea6",level:4},{value:"\u4e0e ThreadPoolExecutor \u7684\u53d6\u820d",id:"\u4e0e-threadpoolexecutor-\u7684\u53d6\u820d",level:4},{value:"\u5b9e\u6218\u8981\u70b9",id:"\u5b9e\u6218\u8981\u70b9",level:4}];function d(n){const e={code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h3,{id:"forkjoinpool-\u4e0e\u5de5\u4f5c\u7a83\u53d6",children:"ForkJoinPool \u4e0e\u5de5\u4f5c\u7a83\u53d6"}),"\n",(0,i.jsx)(e.h4,{id:"toc",children:"ToC"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8bbe\u8ba1\u7406\u5ff5\u4e0e\u9002\u7528\u573a\u666f"}),"\n",(0,i.jsx)(e.li,{children:"RecursiveTask/RecursiveAction"}),"\n",(0,i.jsx)(e.li,{children:"\u5de5\u4f5c\u7a83\u53d6\u4e0e\u5e76\u884c\u5ea6"}),"\n",(0,i.jsx)(e.li,{children:"\u4e0e ThreadPoolExecutor \u7684\u53d6\u820d"}),"\n",(0,i.jsx)(e.li,{children:"\u5b9e\u6218\u4e0e\u5751\u70b9"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"\u8bbe\u8ba1\u7406\u5ff5\u4e0e\u9002\u7528\u573a\u666f",children:"\u8bbe\u8ba1\u7406\u5ff5\u4e0e\u9002\u7528\u573a\u666f"}),"\n",(0,i.jsx)(e.p,{children:"Fork/Join \u9762\u5411\u201c\u53ef\u62c6\u5206\u3001\u53ef\u5408\u5e76\u201d\u7684\u5e76\u884c\u4efb\u52a1\uff08\u5206\u6cbb\uff09\uff0c\u901a\u8fc7\u5de5\u4f5c\u7a83\u53d6\u63d0\u5347 CPU \u5229\u7528\u7387\u3002\u9002\u5408 CPU \u5bc6\u96c6\u578b\u3001\u9012\u5f52/\u533a\u95f4\u7c7b\u8ba1\u7b97\uff1b\u4e0d\u9002\u5408\u5927\u91cf\u963b\u585e I/O\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"\u57fa\u672c\u7528\u6cd5recursivetask",children:"\u57fa\u672c\u7528\u6cd5\uff1aRecursiveTask"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"import java.util.concurrent.*;\n\nclass SumTask extends RecursiveTask<Long> {\n  private static final int THRESHOLD = 10_000;\n  final long[] arr; final int lo, hi;\n  SumTask(long[] arr, int lo, int hi) { this.arr=arr; this.lo=lo; this.hi=hi; }\n  @Override protected Long compute() {\n    int len = hi - lo;\n    if (len <= THRESHOLD) {\n      long s = 0; for (int i=lo;i<hi;i++) s += arr[i]; return s;\n    }\n    int mid = lo + len/2;\n    SumTask left = new SumTask(arr, lo, mid);\n    SumTask right = new SumTask(arr, mid, hi);\n    left.fork(); // \u5f02\u6b65\n    long r = right.compute(); // \u5f53\u524d\u7ebf\u7a0b\u7ee7\u7eed\u53f3\u534a\n    long l = left.join();     // \u7b49\u5de6\u534a\n    return l + r;\n  }\n}\n\nForkJoinPool pool = new ForkJoinPool();\nlong sum = pool.invoke(new SumTask(arr, 0, arr.length));\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"RecursiveAction"})," \u7c7b\u4f3c\uff0c\u4f46\u65e0\u8fd4\u56de\u503c\u3002"]}),"\n",(0,i.jsx)(e.h4,{id:"\u5de5\u4f5c\u7a83\u53d6\u4e0e\u5e76\u884c\u5ea6",children:"\u5de5\u4f5c\u7a83\u53d6\u4e0e\u5e76\u884c\u5ea6"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6bcf\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u7ef4\u62a4\u53cc\u7aef\u961f\u5217\uff08deque\uff09\uff0c\u672c\u5730 LIFO\uff1b\u7a7a\u95f2\u7ebf\u7a0b\u4ece\u4ed6\u4eba\u961f\u5217\u5c3e\u90e8\u201c\u7a83\u53d6\u201d\uff1b"}),"\n",(0,i.jsxs)(e.li,{children:["\u5e76\u884c\u5ea6\u9ed8\u8ba4=CPU \u6838\u6570\uff1b",(0,i.jsx)(e.code,{children:"new ForkJoinPool(parallelism)"})," \u53ef\u81ea\u5b9a\u4e49\uff1b"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"ForkJoinPool.commonPool()"})," \u4f5c\u4e3a\u5168\u5c40\u516c\u5171\u6c60\uff0c",(0,i.jsx)(e.code,{children:"CompletableFuture"})," \u9ed8\u8ba4\u4f7f\u7528\u5b83\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"\u4e0e-threadpoolexecutor-\u7684\u53d6\u820d",children:"\u4e0e ThreadPoolExecutor \u7684\u53d6\u820d"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"ForkJoin \u504f\u5411\u7ec6\u7c92\u5ea6\u3001\u9012\u5f52\u4efb\u52a1\uff1bThreadPool \u66f4\u901a\u7528\u3001\u9002\u5408 I/O \u4e0e\u663e\u5f0f\u961f\u5217\uff1b"}),"\n",(0,i.jsxs)(e.li,{children:["\u907f\u514d\u5728 ForkJoin \u4efb\u52a1\u5185\u6267\u884c\u957f\u65f6\u95f4\u963b\u585e I/O\uff1b\u5982\u5fc5\u987b\uff0c\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"ManagedBlocker"}),"\uff1a"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ForkJoinPool.managedBlock(new ForkJoinPool.ManagedBlocker(){\n  public boolean block() throws InterruptedException { /* \u963b\u585e I/O */ return true; }\n  public boolean isReleasable() { return false; }\n});\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u5b9e\u6218\u8981\u70b9",children:"\u5b9e\u6218\u8981\u70b9"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5408\u7406\u8bbe\u7f6e\u9608\u503c\uff08\u5207\u5206\u7c92\u5ea6\uff09\uff0c\u907f\u514d\u8fc7\u5ea6\u62c6\u5206\u6216\u7c92\u5ea6\u8fc7\u5927\uff1b"}),"\n",(0,i.jsx)(e.li,{children:"\u9012\u5f52\u6811\u4e0d\u5e73\u8861\u65f6\u53ef\u80fd\u4ea7\u751f\u504f\u659c\uff0c\u5fc5\u8981\u65f6\u968f\u673a\u62c6\u5206/\u5206\u5757\uff1b"}),"\n",(0,i.jsxs)(e.li,{children:["\u4e0e ",(0,i.jsx)(e.code,{children:"parallelStream()"}),"\uff1a\u5176\u5e95\u5c42\u901a\u5e38\u7528 commonPool\uff1b\u91cd\u5ea6\u4f7f\u7528\u5efa\u8bae\u81ea\u5efa\u6c60\u907f\u514d\u5e72\u6270\u5176\u4ed6\u4efb\u52a1\u3002"]}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},28453:(n,e,o)=>{o.d(e,{R:()=>c,x:()=>s});var r=o(96540);const i={},l=r.createContext(i);function c(n){const e=r.useContext(l);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),r.createElement(l.Provider,{value:e},n.children)}}}]);
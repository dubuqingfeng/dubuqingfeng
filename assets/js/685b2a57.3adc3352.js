"use strict";(globalThis.webpackChunkdubuqingfeng=globalThis.webpackChunkdubuqingfeng||[]).push([[3519],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var s=i(96540);const o={},t=s.createContext(o);function r(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(t.Provider,{value:n},e.children)}},81117:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"Wiki/programming/nodejs/basics/runtime","title":"runtime","description":"\u8fd0\u884c\u65f6\u67b6\u6784\u4e0e\u4e8b\u4ef6\u5faa\u73af","source":"@site/docs/Wiki/programming/nodejs/basics/runtime.md","sourceDirName":"Wiki/programming/nodejs/basics","slug":"/Wiki/programming/nodejs/basics/runtime","permalink":"/docs/Wiki/programming/nodejs/basics/runtime","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Node.js","permalink":"/docs/wiki/programming/nodejs"},"next":{"title":"cluster","permalink":"/docs/Wiki/programming/nodejs/concurrency/cluster"}}');var o=i(74848),t=i(28453);const r={},c=void 0,l={},a=[{value:"\u8fd0\u884c\u65f6\u67b6\u6784\u4e0e\u4e8b\u4ef6\u5faa\u73af",id:"\u8fd0\u884c\u65f6\u67b6\u6784\u4e0e\u4e8b\u4ef6\u5faa\u73af",level:3},{value:"\u8981\u70b9",id:"\u8981\u70b9",level:4},{value:"\u793a\u4f8b\uff1a\u9636\u6bb5\u4e0e\u5fae\u4efb\u52a1\u4ea4\u4e92",id:"\u793a\u4f8b\u9636\u6bb5\u4e0e\u5fae\u4efb\u52a1\u4ea4\u4e92",level:4},{value:"\u793a\u4f8b\uff1a\u963b\u585e\u4e0e\u4e8b\u4ef6\u5faa\u73af\u5ef6\u8fdf",id:"\u793a\u4f8b\u963b\u585e\u4e0e\u4e8b\u4ef6\u5faa\u73af\u5ef6\u8fdf",level:4}];function d(e){const n={a:"a",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h3,{id:"\u8fd0\u884c\u65f6\u67b6\u6784\u4e0e\u4e8b\u4ef6\u5faa\u73af",children:"\u8fd0\u884c\u65f6\u67b6\u6784\u4e0e\u4e8b\u4ef6\u5faa\u73af"}),"\n",(0,o.jsx)(n.p,{children:"Node \u57fa\u4e8e V8 + libuv\uff0c\u5355\u7ebf\u7a0b\u4e8b\u4ef6\u5faa\u73af + \u7ebf\u7a0b\u6c60 + \u7cfb\u7edf I/O\uff0c\u63d0\u4f9b\u8de8\u5e73\u53f0\u7f51\u7edc/\u6587\u4ef6\u80fd\u529b\u3002"}),"\n",(0,o.jsx)(n.h4,{id:"\u8981\u70b9",children:"\u8981\u70b9"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u4e8b\u4ef6\u5faa\u73af\u9636\u6bb5\uff08libuv\uff09\uff1atimers \u2192 pending callbacks \u2192 idle/prepare \u2192 poll \u2192 check \u2192 close callbacks\uff1b"}),"\n",(0,o.jsx)(n.li,{children:"\u5fae\u4efb\u52a1\uff1a\u6bcf\u4e2a\u9636\u6bb5\u7ed3\u675f\u6e05\u7a7a\u5fae\u4efb\u52a1\u961f\u5217\uff08Promise callbacks\uff09\uff1b"}),"\n",(0,o.jsxs)(n.li,{children:["\u7ebf\u7a0b\u6c60\uff1a",(0,o.jsx)(n.code,{children:"fs"}),"\u3001",(0,o.jsx)(n.code,{children:"crypto"}),"\u3001",(0,o.jsx)(n.code,{children:"dns"})," \u7b49\u4f7f\u7528 libuv \u7ebf\u7a0b\u6c60\uff1b"]}),"\n",(0,o.jsx)(n.li,{children:"\u4e0e\u6d4f\u89c8\u5668\u5dee\u5f02\uff1a\u9636\u6bb5\u5212\u5206\u4e0d\u540c\u3001\u65e0 DOM/APIs\uff1b"}),"\n",(0,o.jsxs)(n.li,{children:["\u53c2\u8003\uff1aJavaScript \u7ae0\u8282\u7684",(0,o.jsx)(n.a,{href:"/docs/Wiki/programming/javascript/async/event-loop",children:"\u4e8b\u4ef6\u5faa\u73af\u4e0e\u4efb\u52a1\u961f\u5217"}),"\u3002"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"\u793a\u4f8b\u9636\u6bb5\u4e0e\u5fae\u4efb\u52a1\u4ea4\u4e92",children:"\u793a\u4f8b\uff1a\u9636\u6bb5\u4e0e\u5fae\u4efb\u52a1\u4ea4\u4e92"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// node >= 16\nconsole.log('start');\nsetTimeout(() => console.log('timeout'), 0); // timers \u9636\u6bb5\nsetImmediate(() => console.log('immediate')); // check \u9636\u6bb5\nPromise.resolve().then(() => console.log('microtask')); // \u5fae\u4efb\u52a1\nprocess.nextTick(() => console.log('nextTick')); // nextTick \u961f\u5217\uff0c\u4f18\u5148\u4e8e\u5fae\u4efb\u52a1\n\n// \u5178\u578b\u8f93\u51fa\uff08\u9876\u5c42\u811a\u672c\uff09\uff1a\n// start\n// nextTick\n// microtask\n// timeout\n// immediate\n// \u6ce8\u610f\uff1a\u5728 I/O \u56de\u8c03\u4e2d\uff0csetImmediate \u901a\u5e38\u5148\u4e8e setTimeout \u89e6\u53d1\u3002\n"})}),"\n",(0,o.jsx)(n.h4,{id:"\u793a\u4f8b\u963b\u585e\u4e0e\u4e8b\u4ef6\u5faa\u73af\u5ef6\u8fdf",children:"\u793a\u4f8b\uff1a\u963b\u585e\u4e0e\u4e8b\u4ef6\u5faa\u73af\u5ef6\u8fdf"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const { monitorEventLoopDelay } = require('perf_hooks');\nconst h = monitorEventLoopDelay();\nh.enable();\n\nsetInterval(() => {\n  console.log('eventLoop p95(ms)=', (h.percentile(95) / 1e6).toFixed(2));\n  h.reset();\n}, 1000);\n\n// \u6a21\u62df CPU \u963b\u585e 200ms\nsetInterval(() => {\n  const end = Date.now() + 200;\n  while (Date.now() < end) {}\n}, 3000);\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u5b9a\u4f4d\u601d\u8def\uff1a\u4f18\u5148\u786e\u8ba4\u662f\u5426 CPU/GC/\u5916\u90e8 I/O \u9971\u548c\uff1b\u7ed3\u5408 ",(0,o.jsx)(n.code,{children:"--cpu-prof"}),"/\u5806\u5feb\u7167\u4e0e\u4e8b\u4ef6\u5faa\u73af\u5ef6\u8fdf\u6307\u6807\u4ea4\u53c9\u9a8c\u8bc1\u3002"]})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);
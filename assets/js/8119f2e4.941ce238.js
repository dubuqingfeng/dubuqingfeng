"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[5267],{30509:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>c,toc:()=>a});const c=JSON.parse('{"id":"Wiki/programming/rust/concurrency/threading","title":"threading","description":"\u7ebf\u7a0b\u3001\u5171\u4eab\u5185\u5b58\u4e0e\u6d88\u606f\u4f20\u9012","source":"@site/docs/Wiki/programming/rust/concurrency/threading.md","sourceDirName":"Wiki/programming/rust/concurrency","slug":"/Wiki/programming/rust/concurrency/threading","permalink":"/docs/Wiki/programming/rust/concurrency/threading","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"async-await","permalink":"/docs/Wiki/programming/rust/async/async-await"},"next":{"title":"error-handling","permalink":"/docs/Wiki/programming/rust/error/error-handling"}}');var i=r(74848),t=r(28453);const s={},l=void 0,o={},a=[{value:"\u7ebf\u7a0b\u3001\u5171\u4eab\u5185\u5b58\u4e0e\u6d88\u606f\u4f20\u9012",id:"\u7ebf\u7a0b\u5171\u4eab\u5185\u5b58\u4e0e\u6d88\u606f\u4f20\u9012",level:3},{value:"\u7ebf\u7a0b\u4e0e Join",id:"\u7ebf\u7a0b\u4e0e-join",level:4},{value:"\u5171\u4eab\u53ef\u53d8\u72b6\u6001\uff1aArc + Mutex/RwLock",id:"\u5171\u4eab\u53ef\u53d8\u72b6\u6001arc--mutexrwlock",level:4},{value:"\u901a\u4fe1\uff1aChannel\uff08mpsc\uff09",id:"\u901a\u4fe1channelmpsc",level:4},{value:"Send/Sync \u6982\u5ff5",id:"sendsync-\u6982\u5ff5",level:4},{value:"\u4e0e Go \u5bf9\u7167",id:"\u4e0e-go-\u5bf9\u7167",level:4}];function d(n){const e={code:"code",h3:"h3",h4:"h4",li:"li",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h3,{id:"\u7ebf\u7a0b\u5171\u4eab\u5185\u5b58\u4e0e\u6d88\u606f\u4f20\u9012",children:"\u7ebf\u7a0b\u3001\u5171\u4eab\u5185\u5b58\u4e0e\u6d88\u606f\u4f20\u9012"}),"\n",(0,i.jsx)(e.h4,{id:"\u7ebf\u7a0b\u4e0e-join",children:"\u7ebf\u7a0b\u4e0e Join"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'use std::thread;\n\nfn main() {\n    let h = thread::spawn(|| {\n        println!("in thread");\n        42\n    });\n    let v = h.join().unwrap();\n    println!("ret={}", v);\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"\u5171\u4eab\u53ef\u53d8\u72b6\u6001arc--mutexrwlock",children:"\u5171\u4eab\u53ef\u53d8\u72b6\u6001\uff1aArc + Mutex/RwLock"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'use std::{sync::{Arc, Mutex}, thread};\n\nfn main() {\n    let counter = Arc::new(Mutex::new(0));\n    let mut hs = vec![];\n    for _ in 0..4 {\n        let c = Arc::clone(&counter);\n        hs.push(thread::spawn(move || {\n            *c.lock().unwrap() += 1;\n        }));\n    }\n    for h in hs { h.join().unwrap(); }\n    println!("{}", *counter.lock().unwrap());\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"\u901a\u4fe1channelmpsc",children:"\u901a\u4fe1\uff1aChannel\uff08mpsc\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'use std::sync::mpsc;\nuse std::thread;\n\nfn main() {\n    let (tx, rx) = mpsc::channel();\n    thread::spawn(move || { tx.send("hi").unwrap(); });\n    println!("{}", rx.recv().unwrap());\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"sendsync-\u6982\u5ff5",children:"Send/Sync \u6982\u5ff5"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"Send"}),"\uff1a\u7c7b\u578b\u53ef\u5728\u7ebf\u7a0b\u95f4\u8f6c\u79fb\u6240\u6709\u6743\uff1b",(0,i.jsx)(e.code,{children:"Sync"}),"\uff1a",(0,i.jsx)(e.code,{children:"&T"})," \u53ef\u5728\u7ebf\u7a0b\u95f4\u5171\u4eab\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5927\u591a\u6570\u5b89\u5168\u7c7b\u578b\u5747\u81ea\u52a8\u5b9e\u73b0\uff1b",(0,i.jsx)(e.code,{children:"Rc<T>"})," \u975e ",(0,i.jsx)(e.code,{children:"Send/Sync"}),"\uff0c\u9700\u7528 ",(0,i.jsx)(e.code,{children:"Arc<T>"}),"\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"\u4e0e-go-\u5bf9\u7167",children:"\u4e0e Go \u5bf9\u7167"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Go \u5f3a\u8c03\u201c\u4e0d\u8981\u901a\u8fc7\u5171\u4eab\u5185\u5b58\u6765\u901a\u4fe1\u201d\uff1bRust \u4e24\u8005\u7686\u53ef\uff0c\u4f46\u901a\u8fc7\u7c7b\u578b\u7cfb\u7edf\u9694\u79bb\u98ce\u9669\u3002"}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},28453:(n,e,r)=>{r.d(e,{R:()=>s,x:()=>l});var c=r(96540);const i={},t=c.createContext(i);function s(n){const e=c.useContext(t);return c.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:s(n.components),c.createElement(t.Provider,{value:e},n.children)}}}]);
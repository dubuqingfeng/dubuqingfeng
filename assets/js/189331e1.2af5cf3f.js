"use strict";(globalThis.webpackChunkdubuqingfeng=globalThis.webpackChunkdubuqingfeng||[]).push([[3306],{28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var t=r(96540);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}},58986:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>a,frontMatter:()=>o,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"Wiki/programming/nodejs/concurrency/cluster","title":"cluster","description":"Cluster \u591a\u8fdb\u7a0b\u6a21\u578b","source":"@site/docs/Wiki/programming/nodejs/concurrency/cluster.md","sourceDirName":"Wiki/programming/nodejs/concurrency","slug":"/Wiki/programming/nodejs/concurrency/cluster","permalink":"/docs/Wiki/programming/nodejs/concurrency/cluster","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"runtime","permalink":"/docs/Wiki/programming/nodejs/basics/runtime"},"next":{"title":"libuv-threadpool","permalink":"/docs/Wiki/programming/nodejs/concurrency/libuv-threadpool"}}');var s=r(74848),i=r(28453);const o={},c=void 0,l={},u=[{value:"Cluster \u591a\u8fdb\u7a0b\u6a21\u578b",id:"cluster-\u591a\u8fdb\u7a0b\u6a21\u578b",level:3},{value:"\u8981\u70b9",id:"\u8981\u70b9",level:4},{value:"\u793a\u4f8b\uff1a\u6700\u5c0f Cluster",id:"\u793a\u4f8b\u6700\u5c0f-cluster",level:4}];function d(e){const n={code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h3,{id:"cluster-\u591a\u8fdb\u7a0b\u6a21\u578b",children:"Cluster \u591a\u8fdb\u7a0b\u6a21\u578b"}),"\n",(0,s.jsx)(n.p,{children:"\u5229\u7528\u591a\u6838\u5e76\u884c\u5904\u7406\u8bf7\u6c42\uff0c\u4e3b\u8fdb\u7a0b\u8d1f\u8d23 fork/\u7ba1\u7406\u5de5\u4f5c\u8fdb\u7a0b\uff0c\u5e38\u4e0e\u53cd\u5411\u4ee3\u7406\u914d\u5408\u3002"}),"\n",(0,s.jsx)(n.h4,{id:"\u8981\u70b9",children:"\u8981\u70b9"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u4e0e\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"\u65e0\u72b6\u6001/\u6709\u72b6\u6001\u670d\u52a1\u7684\u4f1a\u8bdd\u7c98\u6027\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"\u5d29\u6e83\u6062\u590d\u4e0e\u4f18\u96c5\u91cd\u542f\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"\u4e0e\u5bb9\u5668/\u7f16\u6392\uff08K8s\uff09\u7684\u89d2\u8272\u8fb9\u754c\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"\u793a\u4f8b\u6700\u5c0f-cluster",children:"\u793a\u4f8b\uff1a\u6700\u5c0f Cluster"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import cluster from 'node:cluster';\nimport http from 'node:http';\nimport os from 'node:os';\n\nif (cluster.isPrimary) {\n  const n = os.cpus().length;\n  for (let i = 0; i < n; i++) cluster.fork();\n  cluster.on('exit', () => cluster.fork()); // \u5d29\u6e83\u91cd\u542f\n} else {\n  http.createServer((_, res) => res.end(`pid ${process.pid}`)).listen(3000);\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u90e8\u7f72\u62d3\u6251\uff1aNginx/Ingress \u2192 \u591a\u5b9e\u4f8b\uff08\u6216 Cluster\uff09\u2192 \u5e94\u7528\uff1b\u4f1a\u8bdd\u9700\u65e0\u72b6\u6001\u6216\u501f\u52a9\u7c98\u6027/\u5916\u90e8\u4f1a\u8bdd\u5b58\u50a8\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["PM2 \u96c6\u6210\uff1a",(0,s.jsx)(n.code,{children:"pm2 start app.js -i max"})," \u5f00\u542f\u591a\u5b9e\u4f8b\uff1b\u5065\u5eb7\u68c0\u67e5/\u65e5\u5fd7\u8f6e\u8f6c\u4f7f\u7528 PM2 \u63d2\u4ef6\u6216\u5bf9\u63a5\u5916\u90e8\u65b9\u6848\u3002"]})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);
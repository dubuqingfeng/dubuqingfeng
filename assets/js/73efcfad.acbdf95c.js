"use strict";(self.webpackChunkdubuqingfeng=self.webpackChunkdubuqingfeng||[]).push([[6328],{5269:(n,i,e)=>{e.r(i),e.d(i,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"Wiki/programming/rust/memory/drop-unwind-abort","title":"drop-unwind-abort","description":"Drop \u987a\u5e8f\u4e0e panic\uff1a\u5c55\u5f00\uff08unwind\uff09\u4e0e\u4e2d\u6b62\uff08abort\uff09","source":"@site/docs/Wiki/programming/rust/memory/drop-unwind-abort.md","sourceDirName":"Wiki/programming/rust/memory","slug":"/Wiki/programming/rust/memory/drop-unwind-abort","permalink":"/docs/Wiki/programming/rust/memory/drop-unwind-abort","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"borrow-advanced","permalink":"/docs/Wiki/programming/rust/memory/borrow-advanced"},"next":{"title":"interior-mutability","permalink":"/docs/Wiki/programming/rust/memory/interior-mutability"}}');var o=e(74848),d=e(28453);const c={},s=void 0,l={},t=[{value:"Drop \u987a\u5e8f\u4e0e panic\uff1a\u5c55\u5f00\uff08unwind\uff09\u4e0e\u4e2d\u6b62\uff08abort\uff09",id:"drop-\u987a\u5e8f\u4e0e-panic\u5c55\u5f00unwind\u4e0e\u4e2d\u6b62abort",level:3},{value:"Drop \u987a\u5e8f\uff08\u786e\u5b9a\u6027\uff09",id:"drop-\u987a\u5e8f\u786e\u5b9a\u6027",level:4},{value:"panic \u7684\u4e24\u79cd\u7b56\u7565",id:"panic-\u7684\u4e24\u79cd\u7b56\u7565",level:4},{value:"\u4e0e FFI \u7684\u4ea4\u4e92",id:"\u4e0e-ffi-\u7684\u4ea4\u4e92",level:4},{value:"Poison \u4e0e\u6062\u590d",id:"poison-\u4e0e\u6062\u590d",level:4},{value:"\u89c2\u6d4b\u4e0e\u8c03\u8bd5",id:"\u89c2\u6d4b\u4e0e\u8c03\u8bd5",level:4},{value:"\u5e38\u89c1\u9677\u9631",id:"\u5e38\u89c1\u9677\u9631",level:4}];function a(n){const i={code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.h3,{id:"drop-\u987a\u5e8f\u4e0e-panic\u5c55\u5f00unwind\u4e0e\u4e2d\u6b62abort",children:"Drop \u987a\u5e8f\u4e0e panic\uff1a\u5c55\u5f00\uff08unwind\uff09\u4e0e\u4e2d\u6b62\uff08abort\uff09"}),"\n",(0,o.jsx)(i.h4,{id:"drop-\u987a\u5e8f\u786e\u5b9a\u6027",children:"Drop \u987a\u5e8f\uff08\u786e\u5b9a\u6027\uff09"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"\u4f5c\u7528\u57df\u5185\u7684\u5c40\u90e8\u53d8\u91cf\uff1a\u6309\u201c\u9006\u58f0\u660e\u987a\u5e8f\u201d\u9500\u6bc1\uff08\u540e\u58f0\u660e\u7684\u5148 Drop\uff09\u3002"}),"\n",(0,o.jsx)(i.li,{children:"\u7ed3\u6784\u4f53\u5b57\u6bb5\uff1a\u6309\u201c\u58f0\u660e\u987a\u5e8f\u201d\u4f9d\u6b21 Drop\u3002"}),"\n",(0,o.jsx)(i.li,{children:"\u5143\u7ec4/\u6570\u7ec4\uff1a\u5143\u7d20\u4ece\u540e\u5230\u524d Drop\uff08\u6570\u7ec4\u4e3a\u4ece\u6700\u540e\u4e00\u4e2a\u5230\u7b2c\u4e00\u4e2a\uff09\u3002"}),"\n",(0,o.jsx)(i.li,{children:"\u4e34\u65f6\u503c\uff1a\u5728\u8bed\u53e5\u7ed3\u675f\u5904 Drop\uff08\u53d7 NLL/\u4e34\u65f6\u751f\u547d\u5468\u671f\u89c4\u5219\u5f71\u54cd\uff09\u3002"}),"\n"]}),"\n",(0,o.jsx)(i.p,{children:"\u8bbe\u8ba1\u5efa\u8bae\uff1a\u82e5\u5b57\u6bb5 A \u6301\u6709\u5bf9\u5b57\u6bb5 B \u7684\u5f15\u7528\uff0c\u5e94\u8ba9 A \u5728 B \u4e4b\u524d Drop\uff08\u5c06 A \u653e\u5728 B \u4e4b\u524d\u58f0\u660e\uff09\u3002"}),"\n",(0,o.jsx)(i.h4,{id:"panic-\u7684\u4e24\u79cd\u7b56\u7565",children:"panic \u7684\u4e24\u79cd\u7b56\u7565"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:["unwind\uff08\u9ed8\u8ba4\uff09\uff1a\u6cbf\u8c03\u7528\u6808\u5c55\u5f00\uff0c\u8fd0\u884c\u5df2\u8fbe\u6808\u5e27\u4e2d\u5df2\u6784\u9020\u5bf9\u8c61\u7684 Drop\uff0c\u5b9e\u73b0 RAII \u91ca\u653e\uff1b\u53ef\u88ab ",(0,o.jsx)(i.code,{children:"catch_unwind"})," \u6355\u83b7\uff08",(0,o.jsx)(i.code,{children:"UnwindSafe"})," \u7ea6\u675f\uff09\u3002"]}),"\n",(0,o.jsx)(i.li,{children:"abort\uff1a\u8fdb\u7a0b\u76f4\u63a5\u4e2d\u6b62\uff0c\u4e0d\u8fd0\u884c Drop\uff1b\u66f4\u5c0f\u66f4\u5feb\uff0c\u9002\u5408\u5bf9\u4f53\u79ef/\u6027\u80fd\u654f\u611f\u7684\u53d1\u5e03\u4e8c\u8fdb\u5236\u3002"}),"\n"]}),"\n",(0,o.jsx)(i.p,{children:"\u914d\u7f6e\u65b9\u5f0f\uff08Cargo.toml\uff09\uff1a"}),"\n",(0,o.jsx)(i.pre,{children:(0,o.jsx)(i.code,{className:"language-toml",children:'[profile.release]\npanic = "abort"\n'})}),"\n",(0,o.jsx)(i.h4,{id:"\u4e0e-ffi-\u7684\u4ea4\u4e92",children:"\u4e0e FFI \u7684\u4ea4\u4e92"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:["\u7edd\u4e0d\u5141\u8bb8 panic \u7a7f\u8d8a FFI \u8fb9\u754c\u5230 C/C++\uff1a\u5728 FFI \u5165\u53e3\u6355\u83b7\u6216\u4f7f\u7528 ",(0,o.jsx)(i.code,{children:"abort"})," \u7b56\u7565\u3002"]}),"\n",(0,o.jsxs)(i.li,{children:["C/C++ \u8c03\u7528 Rust\uff1a\u5728\u5bfc\u51fa\u51fd\u6570\u6700\u5916\u5c42 ",(0,o.jsx)(i.code,{children:"catch_unwind"}),"\uff0c\u5c06 panic \u8f6c\u6362\u4e3a\u9519\u8bef\u7801\uff1b\u6216\u5c06 ",(0,o.jsx)(i.code,{children:"panic = abort"}),"\u3002"]}),"\n"]}),"\n",(0,o.jsx)(i.h4,{id:"poison-\u4e0e\u6062\u590d",children:"Poison \u4e0e\u6062\u590d"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:[(0,o.jsx)(i.code,{children:"std::sync::Mutex"})," \u5728\u6301\u9501\u7ebf\u7a0b panic \u540e\u4f1a\u6807\u8bb0\u4e3a poison\uff1b\u540e\u7eed ",(0,o.jsx)(i.code,{children:"lock()"})," \u8fd4\u56de ",(0,o.jsx)(i.code,{children:"PoisonError"}),"\uff0c\u8c03\u7528\u65b9\u53ef\u9009\u62e9 ",(0,o.jsx)(i.code,{children:"into_inner()"})," \u5f3a\u5236\u83b7\u53d6\u5e76\u4fee\u590d\u72b6\u6001\u3002"]}),"\n"]}),"\n",(0,o.jsx)(i.h4,{id:"\u89c2\u6d4b\u4e0e\u8c03\u8bd5",children:"\u89c2\u6d4b\u4e0e\u8c03\u8bd5"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:["\u4f7f\u7528 ",(0,o.jsx)(i.code,{children:"RUST_BACKTRACE=1"})," \u67e5\u770b\u56de\u6eaf\uff08unwind\uff09\uff1b\u7ed3\u5408\u65e5\u5fd7/\u6307\u6807\uff0c\u5728 Drop \u5b9e\u73b0\u91cc\u6253\u5370\u6536\u5c3e\u4fe1\u606f\u3002"]}),"\n"]}),"\n",(0,o.jsx)(i.h4,{id:"\u5e38\u89c1\u9677\u9631",children:"\u5e38\u89c1\u9677\u9631"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:["\u5728 Drop \u4e2d panic \u4f1a\u89e6\u53d1\u53cc\u91cd panic\uff1aunwind \u4e0b\u4f1a ",(0,o.jsx)(i.code,{children:"abort"}),"\uff1b"]}),"\n",(0,o.jsxs)(i.li,{children:["\u4f7f\u7528 ",(0,o.jsx)(i.code,{children:"mem::forget"})," \u7ed5\u8fc7 Drop \u9700\u5c0f\u5fc3\u8d44\u6e90\u6cc4\u6f0f\uff1b"]}),"\n",(0,o.jsxs)(i.li,{children:["\u5728 async \u4e2d\u6301\u9501 ",(0,o.jsx)(i.code,{children:".await"})," \u5bfc\u81f4\u5e7f\u57df\u6301\u9501\uff0c\u4e00\u65e6 panic \u53ef\u80fd poison \u5927\u8303\u56f4\u72b6\u6001\u3002"]}),"\n"]})]})}function p(n={}){const{wrapper:i}={...(0,d.R)(),...n.components};return i?(0,o.jsx)(i,{...n,children:(0,o.jsx)(a,{...n})}):a(n)}},28453:(n,i,e)=>{e.d(i,{R:()=>c,x:()=>s});var r=e(96540);const o={},d=r.createContext(o);function c(n){const i=r.useContext(d);return r.useMemo((function(){return"function"==typeof n?n(i):{...i,...n}}),[i,n])}function s(n){let i;return i=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:c(n.components),r.createElement(d.Provider,{value:i},n.children)}}}]);